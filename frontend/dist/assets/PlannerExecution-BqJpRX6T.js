import{j as e}from"./index-CtfDg2Lg.js";import{e as t,f as s,r as a}from"./react-vendor-BFe66WFD.js";import{y as n}from"./ui-vendor-i8Pm06Jj.js";/* empty css                      */import{S as i}from"./ScannerModal-CXFaW436.js";const r=()=>{const{setTitle:r}=t(),[c]=s(),d=(new Date).toISOString().split("T")[0],[o,l]=a.useState(c.get("date")||d);a.useEffect(()=>{r("Ejecución Diaria de Conteos")},[r]);const[x,m]=a.useState([]),[h,p]=a.useState(!1),[u,f]=a.useState(null),[g,y]=a.useState(null),[v,j]=a.useState(!1),[b,w]=a.useState(!1);a.useEffect(()=>{o&&N(o)},[o]);const N=async e=>{p(!0),f(null),m([]);try{const t=await fetch(`/api/planner/execution/daily_items?date=${e}`);if(!t.ok)throw new Error("Error al cargar ítems planificados");const s=(await t.json()).map(e=>({...e,physical_qty:"",difference:null,status:"pending"}));m(s)}catch(t){f(t.message)}finally{p(!1)}};return e.jsxs("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 py-4 sm:py-8",children:[e.jsxs("div",{className:"bg-white p-3 sm:p-4 rounded-lg shadow mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("label",{className:"font-semibold text-gray-700 text-sm whitespace-nowrap",children:"Fecha:"}),e.jsx("input",{type:"date",value:o,onChange:e=>l(e.target.value),className:"flex-1 rounded border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N(o),className:"flex-1 sm:flex-none bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2.5 rounded text-sm font-medium transition-colors",children:"Actualizar"}),e.jsxs("button",{onClick:()=>w(!0),className:"flex-1 sm:flex-none bg-gray-700 hover:bg-gray-800 text-white px-4 py-2.5 rounded text-sm font-medium transition-colors flex items-center justify-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z"}),e.jsx("path",{d:"M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z"}),e.jsx("path",{d:"M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z"}),e.jsx("path",{d:"M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z"}),e.jsx("path",{d:"M12 9h2V8h-2z"})]}),e.jsx("span",{className:"hidden sm:inline",children:"Escanear"}),e.jsx("span",{className:"sm:hidden",children:"Scan"})]})]})]}),g&&e.jsx("span",{className:"block mt-2 text-green-600 text-sm font-medium",children:g})]}),h?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"})}):u?e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-600 p-4 rounded",children:u}):0===x.length?e.jsx("div",{className:"text-center py-12 text-gray-500 bg-white rounded shadow",children:"No hay ítems planificados para esta fecha."}):e.jsx("div",{className:"bg-white shadow overflow-hidden rounded-lg",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-[#34495e] text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider w-auto",children:"Item"}),e.jsx("th",{className:"px-2 py-3 text-center text-xs font-semibold uppercase tracking-wider w-24",children:"Ubicación"}),e.jsx("th",{className:"px-2 py-3 text-center text-xs font-semibold uppercase tracking-wider w-16",children:"ABC"}),e.jsx("th",{className:"px-2 py-3 text-center text-xs font-semibold uppercase tracking-wider w-16",children:"Sistema"}),e.jsx("th",{className:"px-1 py-3 text-center text-xs font-semibold uppercase tracking-wider w-16",children:"Físico"}),e.jsx("th",{className:"px-1 py-3 text-center text-xs font-semibold uppercase tracking-wider w-16",children:"Dif"}),e.jsx("th",{className:"px-2 py-3 text-center text-xs font-semibold uppercase tracking-wider w-20",children:"Acción"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map((t,s)=>e.jsxs("tr",{className:t.saved?"bg-green-50":"",children:[e.jsxs("td",{className:"px-2 py-2",children:[e.jsx("div",{className:"text-sm font-medium text-indigo-600",children:t.item_code}),e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-[150px] sm:max-w-xs",children:t.description})]}),e.jsx("td",{className:"px-1 py-2 text-sm text-gray-500 font-mono text-center",children:t.bin_location||"N/A"}),e.jsx("td",{className:"px-1 py-2 text-sm text-gray-500 text-center",children:t.abc_code}),e.jsx("td",{className:"px-1 py-2 text-sm text-center text-gray-900 font-medium",children:t.system_qty||0}),e.jsx("td",{className:"px-0 py-2 text-center",children:e.jsx("input",{id:`qty-${s}`,type:"number",className:"w-10 sm:w-12 text-center p-0 border rounded border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 text-sm no-spinner",value:t.physical_qty,onChange:e=>((e,t)=>{const s=[...x];s[e].physical_qty=t,m(s)})(s,e.target.value),onBlur:()=>(e=>{const t=[...x],s=t[e],a=parseInt(s.physical_qty);if(!isNaN(a)){const e=s.system_qty||0;s.difference=a-e,s.status="counted"}m(t)})(s),disabled:t.saved})}),e.jsx("td",{className:"px-1 py-2 text-center",children:null!==t.difference&&e.jsx("span",{className:"px-1.5 inline-flex text-xs leading-5 font-semibold rounded-full "+(0===t.difference?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t.difference>0?`+${t.difference}`:t.difference})}),e.jsx("td",{className:"px-1 py-2 text-center",children:t.saved?e.jsx("span",{className:"text-green-600 font-bold text-xs",children:"OK"}):e.jsx("button",{onClick:()=>(async e=>{const t=x[e];if("counted"===t.status){j(!0),f(null),y(null);try{const s={item_code:t.item_code,item_description:t.description,bin_location:t.bin_location||"N/A",system_qty:t.system_qty||0,physical_qty:parseInt(t.physical_qty),difference:t.difference,executed_date:o,username:"admin",abc_code:t.abc_code};if(!(await fetch("/api/planner/save_execution",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("Error al guardar el conteo");y(`Conteo guardado para ${t.item_code}`),n.success(`Guardado: ${t.item_code}`);const a=[...x];a[e].saved=!0,m(a)}catch(s){f(s.message),n.error("Error al guardar")}finally{j(!1)}}})(s),disabled:v||"counted"!==t.status,className:"text-white px-2 py-1 rounded text-xs font-bold transition-colors "+("counted"===t.status?"bg-indigo-600 hover:bg-indigo-700":"bg-gray-300 cursor-not-allowed"),children:"Guardar"})})]},s))})]})})}),b&&e.jsx(i,{onScan:e=>{w(!1);const t=e.trim().toUpperCase(),s=x.findIndex(e=>e.item_code===t);-1!==s?(n.success(`Item encontrado: ${t}`),setTimeout(()=>{const e=document.getElementById(`qty-${s}`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.focus(),e.select())},100)):n.warning("Item no está en la lista de hoy")},onClose:()=>w(!1)})]})};export{r as default};
