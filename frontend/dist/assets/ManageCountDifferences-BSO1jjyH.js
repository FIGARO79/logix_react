import{j as e,L as s}from"./index-wQJwC0jU.js";import{r as t}from"./react-vendor-BFe66WFD.js";const a=()=>{const[a,r]=t.useState([]),[l,i]=t.useState([]),[n,d]=t.useState(!1),[c,o]=t.useState(null),[x,m]=t.useState(null),[h,p]=t.useState(""),[u,b]=t.useState("all"),[j,f]=t.useState({open:!1,id:null,itemCode:"",desc:"",loc:"",system:0,counted:0}),[g,N]=t.useState({open:!1,id:null,itemCode:""});t.useEffect(()=>{y()},[]),t.useEffect(()=>{v()},[a,h,u]);const y=async()=>{d(!0),o(null);try{const e=await fetch("/api/counts/differences");if(!e.ok)throw new Error("Error al cargar datos");const s=await e.json();r(s.items||[])}catch(e){o(e.message)}finally{d(!1)}},v=()=>{let e=[...a];const s=h.toUpperCase();s&&(e=e.filter(e=>e.item_code.includes(s))),"negative"===u?e=e.filter(e=>e.difference<0):"positive"===u?e=e.filter(e=>e.difference>0):"zero"===u&&(e=e.filter(e=>0===e.difference)),i(e)};return e.jsxs(s,{title:"GestiÃ³n de Diferencias de Conteo",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-normal text-gray-800",children:"GestiÃ³n de Diferencias"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Verifica y edita las cantidades contadas vs. sistema"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{window.location.href="/api/export_counts"},className:"btn-sap btn-secondary flex items-center gap-2",children:[e.jsx("span",{className:"text-green-600 font-bold",children:"â¬‡"})," Exportar Excel"]}),e.jsxs("button",{onClick:y,className:"btn-sap btn-secondary flex items-center gap-2",children:[e.jsx("span",{children:"â†»"})," Actualizar"]})]})]}),x&&e.jsx("div",{className:"bg-green-100 text-green-800 p-3 rounded mb-4 border border-green-200",children:x}),c&&e.jsx("div",{className:"bg-red-100 text-red-800 p-3 rounded mb-4 border border-red-200",children:c}),e.jsxs("div",{className:"bg-white p-4 rounded shadow border border-gray-200 mb-6 flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-gray-500 mb-1",children:"Filtrar por Item Code"}),e.jsx("input",{type:"text",className:"w-full border p-2 rounded text-sm uppercase",placeholder:"EJ: ABC123...",value:h,onChange:e=>p(e.target.value)})]}),e.jsxs("div",{className:"flex-1 min-w-[150px]",children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-gray-500 mb-1",children:"Mostrar"}),e.jsxs("select",{className:"w-full border p-2 rounded text-sm",value:u,onChange:e=>b(e.target.value),children:[e.jsx("option",{value:"all",children:"Todas las diferencias"}),e.jsx("option",{value:"negative",children:"Solo negativas ( - )"}),e.jsx("option",{value:"positive",children:"Solo positivas ( + )"}),e.jsx("option",{value:"zero",children:"Diferencia 0"})]})]}),e.jsx("div",{children:e.jsx("button",{onClick:()=>{p(""),b("all")},className:"btn-sap btn-secondary h-[38px]",children:"Limpiar Filtros"})})]}),e.jsx("div",{className:"bg-white rounded shadow overflow-hidden border border-gray-200",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"uppercase font-semibold border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 w-20",children:"Acciones"}),e.jsx("th",{className:"p-3",children:"Item Code"}),e.jsx("th",{className:"p-3",children:"DescripciÃ³n"}),e.jsx("th",{className:"p-3",children:"UbicaciÃ³n"}),e.jsx("th",{className:"p-3 text-right",children:"Qty Sistema"}),e.jsx("th",{className:"p-3 text-right",children:"Qty Contada"}),e.jsx("th",{className:"p-3 text-right",children:"Diferencia"}),e.jsx("th",{className:"p-3 text-right",children:"% Var"}),e.jsx("th",{className:"p-3",children:"Fecha"}),e.jsx("th",{className:"p-3",children:"Usuario"})]})}),e.jsxs("tbody",{className:"divide-y",children:[n&&e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"p-6 text-center text-gray-500",children:"Cargando datos..."})}),!n&&0===l.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"p-6 text-center text-gray-500",children:"No hay registros para mostrar."})}),l.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 "+(0!==s.difference?"bg-orange-50/30":""),children:[e.jsxs("td",{className:"p-3 flex gap-2",children:[e.jsx("button",{onClick:()=>(e=>{f({open:!0,id:e.count_id,itemCode:e.item_code,desc:e.description,loc:e.location,system:e.system_qty,counted:e.counted_qty})})(s),className:"text-blue-600 hover:text-blue-800",title:"Editar",children:"âœŽ"}),e.jsx("button",{onClick:()=>(e=>{N({open:!0,id:e.count_id,itemCode:e.item_code})})(s),className:"text-red-600 hover:text-red-800",title:"Eliminar",children:"ðŸ—‘"})]}),e.jsx("td",{className:"p-3 font-semibold text-blue-800",children:s.item_code}),e.jsx("td",{className:"p-3 truncate max-w-xs",title:s.description,children:s.description}),e.jsx("td",{className:"p-3",children:s.location}),e.jsx("td",{className:"p-3 text-right",children:s.system_qty}),e.jsx("td",{className:"p-3 text-right font-bold",children:s.counted_qty}),e.jsx("td",{className:"p-3 text-right font-bold "+(s.difference>0?"text-blue-600":s.difference<0?"text-red-600":"text-gray-400"),children:s.difference>0?`+${s.difference}`:s.difference}),e.jsxs("td",{className:"p-3 text-right",children:[s.percentage_variance,"%"]}),e.jsx("td",{className:"p-3 text-xs text-gray-500 whitespace-nowrap",children:s.date}),e.jsx("td",{className:"p-3 text-xs text-gray-500",children:s.username})]},s.count_id))]})]})})})]}),j.open&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Editar Cantidad Contada"}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-xs text-gray-500 uppercase",children:"Item Code:"})," ",e.jsx("div",{className:"font-mono",children:j.itemCode})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-xs text-gray-500 uppercase",children:"DescripciÃ³n:"})," ",e.jsx("div",{className:"text-sm",children:j.desc})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-xs text-gray-500 uppercase",children:"UbicaciÃ³n:"})," ",e.jsx("div",{children:j.loc})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-xs text-gray-500 uppercase",children:"Qty Sistema:"})," ",e.jsx("div",{children:j.system})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold mb-1",children:"Nueva Cantidad Contada"}),e.jsx("input",{type:"number",className:"w-full border-2 border-blue-500 rounded p-2 text-xl font-bold",value:j.counted,onChange:e=>f({...j,counted:e.target.value}),autoFocus:!0,min:"0"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>f({...j,open:!1}),className:"px-4 py-2 border rounded hover:bg-gray-100",children:"Cancelar"}),e.jsx("button",{onClick:async()=>{const e=parseInt(j.counted);if(isNaN(e)||e<0)alert("Cantidad invÃ¡lida");else try{if(!(await fetch(`/api/counts/${j.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({counted_qty:e})})).ok)throw new Error("Error al guardar");m("Cantidad actualizada exitosamente"),f({...j,open:!1}),y(),setTimeout(()=>m(null),3e3)}catch(s){alert(s.message)}},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-bold",children:"Guardar Cambios"})]})]})}),g.open&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-sm p-6 border-t-4 border-red-600",children:[e.jsx("h2",{className:"text-lg font-bold mb-2 text-red-700",children:"Confirmar EliminaciÃ³n"}),e.jsxs("p",{className:"mb-4 text-gray-700",children:["Â¿EstÃ¡s seguro de que deseas eliminar el registro del item ",e.jsx("strong",{children:g.itemCode}),"?"]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>N({...g,open:!1}),className:"px-4 py-2 border rounded hover:bg-gray-100",children:"Cancelar"}),e.jsx("button",{onClick:async()=>{try{if(!(await fetch(`/api/counts/${g.id}`,{method:"DELETE"})).ok)throw new Error("Error al eliminar");m("Registro eliminado"),N({...g,open:!1}),y(),setTimeout(()=>m(null),3e3)}catch(e){alert(e.message)}},className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 font-bold",children:"Eliminar"})]})]})})]})};export{a as default};
