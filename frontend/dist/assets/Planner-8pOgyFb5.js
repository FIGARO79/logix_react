import{j as e}from"./index-BYgTg5Ia.js";import{e as r,r as a,L as t}from"./react-vendor-BFe66WFD.js";const l=()=>{const{setTitle:l}=r(),[s,d]=a.useState({start_date:"",end_date:"",holidays:[]}),[o,n]=a.useState([]),[c,i]=a.useState(!1),[x,b]=a.useState({executed:{},delta:{}}),[h,p]=a.useState("");a.useEffect(()=>{l("Logix - Planeación de Conteos")},[l]);const[y,g]=a.useState({counts:{A:0,B:0,C:0},req:{A:0,B:0,C:0},daily:{A:0,B:0,C:0},workingDays:0,totalReq:0,totalDaily:0,monthlyPlanned:{A:Array(12).fill(0),B:Array(12).fill(0),C:Array(12).fill(0),Total:Array(12).fill(0)}});a.useEffect(()=>{(async()=>{try{const e=await fetch("/api/planner/config");if(e.ok){const r=await e.json();d(r),p(r.holidays?r.holidays.join("\n"):"")}const r=await fetch("/api/planner/current_plan");if(r.ok){const e=await r.json(),a=Array.isArray(e)?e:e.details||[];n(a)}const a=await fetch("/api/planner/execution/stats");if(a.ok){const e=await a.json();b(e)}}catch(e){}})()},[]),a.useEffect(()=>{m()},[o,s]);const m=()=>{if(!o.length)return;const e={A:new Set,B:new Set,C:new Set},r={A:Array(12).fill(0),B:Array(12).fill(0),C:Array(12).fill(0)};o.forEach(a=>{const t=a["ABC Code"]||"C",l=a["Item Code"],s=a["Planned Date"];if(!s)return;const d=new Date(s).getMonth();e[t]&&e[t].add(l),r[t]&&r[t][d]++});const a={A:e.A.size,B:e.B.size,C:e.C.size},t={A:3*a.A,B:2*a.B,C:1*a.C};let l=0;if(s.start_date&&s.end_date){const e=new Date(s.start_date),r=new Date(s.end_date),a=h.split("\n").filter(e=>e.trim()).map(e=>new Date(e).toDateString());let t=new Date(e);for(;t<=r;){const e=t.getDay();0===e||6===e||a.includes(t.toDateString())||l++,t.setDate(t.getDate()+1)}}const d=Array(12).fill(0).map((e,a)=>r.A[a]+r.B[a]+r.C[a]);g({counts:a,req:t,daily:{A:l?(t.A/l).toFixed(1):0,B:l?(t.B/l).toFixed(1):0,C:l?(t.C/l).toFixed(1):0},workingDays:l,totalReq:t.A+t.B+t.C,totalDaily:l?((t.A+t.B+t.C)/l).toFixed(1):0,monthlyPlanned:{...r,Total:d}})},j=({label:r,data:a,isTotal:t=!1})=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-3 py-1 text-left "+(t?"font-bold bg-gray-50":"font-medium"),children:r}),a&&a.map((r,a)=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:r},a)),e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center "+(t?"font-bold bg-gray-100":"font-bold bg-gray-50 text-gray-900"),children:a?a.reduce((e,r)=>e+r,0):0})]});return e.jsxs("div",{className:"container-wrapper max-w-[1600px] mx-auto p-4 font-sans text-sm text-[#32383e]",children:[e.jsxs("div",{className:"bg-white p-4 rounded shadow-sm border border-gray-200 mb-6",children:[e.jsx("h2",{className:"text-base font-bold text-gray-800 mb-2 border-l-4 border-[#0070d2] pl-2",children:"Parámetros Generales"}),e.jsxs("div",{className:"flex flex-wrap items-end gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1",children:"Fecha Inicial"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded px-2 py-1 text-sm focus:border-blue-500 outline-none",value:s.start_date,onChange:e=>d({...s,start_date:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1",children:"Fecha Final"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded px-2 py-1 text-sm focus:border-blue-500 outline-none",value:s.end_date,onChange:e=>d({...s,end_date:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1",children:"Festivos (Calc)"}),e.jsx("input",{readOnly:!0,className:"border border-gray-300 rounded px-2 py-1 text-sm bg-gray-100 w-20 text-center",value:s.holidays?s.holidays.length:0})]}),e.jsxs("div",{className:"ml-auto flex gap-2",children:[e.jsx("button",{onClick:async()=>{const e=h.split("\n").map(e=>e.trim()).filter(e=>e),r={...s,holidays:e};try{(await fetch("/api/planner/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok&&(d(r),alert("Configuración guardada."))}catch(a){alert("Error guardando configuración.")}},className:"bg-green-600 text-white px-4 py-1.5 rounded text-sm hover:bg-green-700",children:"Guardar Fechas"}),e.jsx("button",{onClick:async()=>{i(!0);try{const e=new URLSearchParams({start_date:s.start_date,end_date:s.end_date}).toString(),r=await fetch(`/api/planner/update_plan?${e}`,{method:"POST"});if(r.ok){const e=await r.json();n(e.details||[]),alert("Planificación actualizada correctamente.")}else alert("Error al actualizar planificación.")}catch(e){alert("Error de conexión.")}finally{i(!1)}},disabled:c,className:"bg-blue-800 text-white px-4 py-1.5 rounded text-sm hover:bg-blue-900 border border-blue-900",children:c?"Calculando...":"Actualizar Planificación"}),e.jsx("button",{onClick:()=>window.location.href=`/api/planner/generate_plan?start_date=${s.start_date}&end_date=${s.end_date}`,className:"bg-blue-600 text-white px-4 py-1.5 rounded text-sm hover:bg-blue-700",children:"Generar Excel"})]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-sm border border-gray-200 mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-bold text-purple-800 mb-0 border-l-4 border-purple-800 pl-2",children:"Ejecución Diaria"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 pl-3",children:"Accede a la interfaz de conteo ciego."})]}),e.jsx(t,{to:"/planner/execution",className:"bg-purple-700 text-white px-6 py-2.5 rounded shadow hover:bg-purple-800 flex items-center gap-2 font-bold no-underline",children:"Ir a Pantalla de Conteo"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-gray-800 mb-2 border-l-4 border-[#0070d2] pl-2",children:"Resumen Categorías (ABC)"}),e.jsxs("table",{className:"w-full border-collapse text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"border border-gray-400 px-2 py-1",children:"Categoría"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1",children:"N° Items"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1",children:"Ciclos"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1",children:"Total Req"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1",children:"Items/Día"})]})}),e.jsxs("tbody",{children:[["A","B","C"].map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-400 px-2 py-1 font-bold text-center",children:r}),e.jsx("td",{className:"border border-gray-400 px-2 py-1 text-center bg-gray-50",children:y.counts[r]}),e.jsx("td",{className:"border border-gray-400 px-2 py-1 text-center",children:"A"===r?3:"B"===r?2:1}),e.jsx("td",{className:"border border-gray-400 px-2 py-1 text-center bg-gray-50",children:y.req[r]}),e.jsx("td",{className:"border border-gray-400 px-2 py-1 text-center bg-gray-50",children:y.daily[r]})]},r)),e.jsxs("tr",{className:"border-t-2 border-gray-400",children:[e.jsx("td",{colSpan:"2",className:"border border-gray-400 px-2 py-1 font-bold text-right",children:"Días Útiles:"}),e.jsx("td",{colSpan:"3",className:"border border-gray-400 px-2 py-1 font-bold bg-yellow-50 text-center",children:y.workingDays})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2",className:"border border-gray-400 px-2 py-1 font-bold text-right",children:"Total Requerido:"}),e.jsx("td",{colSpan:"3",className:"border border-gray-400 px-2 py-1 font-bold bg-yellow-50 text-center",children:y.totalReq})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-gray-800 mb-2 border-l-4 border-[#0070d2] pl-2",children:"Leyenda / Clasificación"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("table",{className:"w-auto border-collapse text-xs h-fit shadow-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#34495e] text-white",children:[e.jsx("th",{className:"border border-gray-400 px-2 py-1 uppercase tracking-wider text-[10px]",children:"Código"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1 uppercase tracking-wider text-[10px] w-32",children:"Criterio (Hits)"})]})}),e.jsx("tbody",{children:[{c:"W",h:"More than 30 hits"},{c:"X",h:"11-30 hits"},{c:"Y",h:"7-10 hits"},{c:"K",h:"5-6 hits"},{c:"L",h:"3-4 hits"},{c:"Z",h:"1-2 hits"},{c:"0",h:"Non moving item"}].map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-0.5 font-bold text-center bg-gray-50",children:r.c}),e.jsx("td",{className:"border border-gray-300 px-2 py-0.5 text-left whitespace-nowrap bg-white",children:r.h})]},r.c))})]}),e.jsxs("div",{className:"flex-grow border border-gray-300 rounded bg-white flex flex-col shadow-sm",children:[e.jsx("div",{className:"bg-gray-200 px-2 py-1 text-xs font-bold border-b border-gray-300 text-center text-gray-700",children:"Festivos (YYYY-MM-DD)"}),e.jsx("textarea",{className:"w-full p-2 text-xs bg-transparent outline-none resize-none font-mono flex-grow",value:h,onChange:e=>p(e.target.value),placeholder:"2024-01-01\n2024-05-01"})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"border-l-4 border-blue-600 bg-gray-50 px-4 py-2",children:e.jsx("h3",{className:"text-sm font-bold text-blue-800",children:"Planeado (Conteos Programados)"})}),e.jsx("div",{className:"p-0 overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-3 py-1.5 text-left font-bold min-w-[150px]",children:"Categoria/Mes"}),["ENE","FEB","MAR","ABR","MAY","JUN","JUL","AGO","SEP","OCT","NOV","DIC"].map(r=>e.jsx("th",{className:"border border-gray-300 px-2 py-1.5 text-center font-bold",children:r},r)),e.jsx("th",{className:"border border-gray-300 px-2 py-1.5 text-center font-bold",children:"TOTAL"})]})}),e.jsxs("tbody",{className:"text-gray-600",children:[e.jsx(j,{label:"A",data:y.monthlyPlanned.A}),e.jsx(j,{label:"B",data:y.monthlyPlanned.B}),e.jsx(j,{label:"C",data:y.monthlyPlanned.C}),e.jsx(j,{label:"TOTAL",data:y.monthlyPlanned.Total,isTotal:!0})]})]})})]}),e.jsxs("div",{className:"bg-white rounded shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"border-l-4 border-green-600 bg-gray-50 px-4 py-2",children:e.jsx("h3",{className:"text-sm font-bold text-green-800",children:"Ejecutado (Real)"})}),e.jsx("div",{className:"p-0 overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-3 py-1.5 text-left font-bold min-w-[150px]",children:"Categoria/Mes"}),["ENE","FEB","MAR","ABR","MAY","JUN","JUL","AGO","SEP","OCT","NOV","DIC"].map(r=>e.jsx("th",{className:"border border-gray-300 px-2 py-1.5 text-center font-bold",children:r},r)),e.jsx("th",{className:"border border-gray-300 px-2 py-1.5 text-center font-bold",children:"W2W"})]})}),e.jsxs("tbody",{className:"text-gray-600",children:[x.executed&&e.jsxs(e.Fragment,{children:[e.jsx(j,{label:"A",data:x.executed.A||Array(12).fill(0)}),e.jsx(j,{label:"B",data:x.executed.B||Array(12).fill(0)}),e.jsx(j,{label:"C",data:x.executed.C||Array(12).fill(0)}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-3 py-1 text-left font-bold bg-gray-50",children:"TOTAL"}),Array(12).fill(0).map((r,a)=>{var t,l,s;const d=((null==(t=x.executed.A)?void 0:t[a])||0)+((null==(l=x.executed.B)?void 0:l[a])||0)+((null==(s=x.executed.C)?void 0:s[a])||0);return e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center font-bold bg-gray-50",children:d},a)}),e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center font-bold bg-gray-200",children:["A","B","C"].reduce((e,r)=>e+(x.executed[r]||[]).reduce((e,r)=>e+r,0),0)})]})]}),!x.executed&&e.jsx("tr",{children:e.jsx("td",{colSpan:"14",className:"text-center py-4 italic text-gray-400",children:"Cargando datos de ejecución..."})})]})]})})]}),e.jsxs("div",{className:"bg-white rounded shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"border-l-4 border-red-600 bg-gray-50 px-4 py-2",children:e.jsx("h3",{className:"text-sm font-bold text-red-800",children:"Delta (Diferencia)"})}),e.jsx("div",{className:"p-0 overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-3 py-1.5 text-left font-bold min-w-[150px]",children:"Categoria/Mes"}),["ENE","FEB","MAR","ABR","MAY","JUN","JUL","AGO","SEP","OCT","NOV","DIC"].map(r=>e.jsx("th",{className:"border border-gray-300 px-2 py-1.5 text-center font-bold",children:r},r)),e.jsx("th",{className:"border border-gray-300 px-2 py-1.5 text-center font-bold",children:"TOTAL"})]})}),e.jsx("tbody",{className:"text-gray-600",children:x.delta&&e.jsxs(e.Fragment,{children:[e.jsx(j,{label:"A",data:x.delta.A||Array(12).fill(0)}),e.jsx(j,{label:"B",data:x.delta.B||Array(12).fill(0)}),e.jsx(j,{label:"C",data:x.delta.C||Array(12).fill(0)}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-3 py-1 text-left font-bold bg-gray-50",children:"TOTAL"}),Array(12).fill(0).map((r,a)=>{var t,l,s;const d=((null==(t=x.delta.A)?void 0:t[a])||0)+((null==(l=x.delta.B)?void 0:l[a])||0)+((null==(s=x.delta.C)?void 0:s[a])||0);return e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center font-bold bg-gray-50",children:d},a)}),e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center font-bold bg-gray-200",children:["A","B","C"].reduce((e,r)=>e+(x.delta[r]||[]).reduce((e,r)=>e+r,0),0)})]})]})})]})})]})]})]})};export{l as default};
