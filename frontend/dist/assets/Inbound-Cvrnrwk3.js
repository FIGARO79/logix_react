import{j as e}from"./index-Ct3ZkX5-.js";import{e as t,r as a}from"./react-vendor-BFe66WFD.js";import{b as i}from"./qrcode-vendor-cb-SQVWm.js";import{S as n}from"./ScannerModal-Cl54tHGj.js";/* empty css              */import"./ui-vendor-i8Pm06Jj.js";const s=()=>{const{setTitle:s}=t();a.useEffect(()=>{s("Logix - Inbound")},[s]);const[l,r]=a.useState(""),[d,o]=a.useState(""),[c,m]=a.useState(""),[h,p]=a.useState(""),[x,b]=a.useState(""),[u,g]=a.useState(null),[f,v]=a.useState([]),[j,y]=a.useState([]),[N,w]=a.useState(!1),[C,R]=a.useState(!1),[S,k]=a.useState(null),[E,I]=a.useState(null),D=a.useRef(null),z=a.useRef(null);a.useEffect(()=>{B(),$()},[]),a.useEffect(()=>{(null==u?void 0:u.itemCode)?i.toDataURL(u.itemCode,{width:96,margin:1}).then(e=>k(e)).catch(e=>{}):k(null)},[u]);const B=async(e="")=>{try{const t=e?`/api/get_logs?version_date=${e}`:"/api/get_logs",a=await fetch(t);a.ok&&v(await a.json())}catch(t){}},$=async()=>{try{const e=await fetch("/api/inbound/versions");e.ok&&y(await e.json())}catch(e){}},q=async()=>{var e;if(c&&l){w(!0);try{const t=await fetch(`/api/find_item/${encodeURIComponent(c)}/${encodeURIComponent(l)}`),a=await t.json();t.ok?(g(a),E||p(""),null==(e=D.current)||e.focus()):(alert(a.error||"Item no encontrado"),g(null))}catch(t){alert("Error de conexi√≥n")}finally{w(!1)}}else alert("Ingrese Import Reference e Item Code")},L=()=>{I(null),m(""),p(""),b(""),g(null)},U=e=>{e&&l&&(w(!0),fetch(`/api/find_item/${encodeURIComponent(e)}/${encodeURIComponent(l)}`).then(e=>e.json()).then(e=>{var t;e.error?(alert(e.error),g(null)):(g(e),E||p(""),null==(t=D.current)||t.focus())}).catch(()=>alert("Error de conexi√≥n")).finally(()=>w(!1)))},A=u?parseInt(h||0)-(u.defaultQtyGrn||0):0,H=u?(parseFloat(u.weight||0)*parseInt(h||1)).toFixed(2):"N/A";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container-wrapper px-4 py-4",children:[e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),!u)return alert("Busque un item primero");const t={importReference:l.toUpperCase(),waybill:d.toUpperCase(),itemCode:u.itemCode,quantity:parseInt(h),relocatedBin:x.toUpperCase()};try{let e;if(e=E?await fetch(`/api/inbound/log/${E}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({waybill:t.waybill,qtyReceived:t.quantity,relocatedBin:t.relocatedBin})}):await fetch("/api/add_log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),e.ok)B(),L();else{const t=await e.json();alert(t.detail||t.error||"Error al guardar")}}catch(a){alert("Error de conexi√≥n")}},children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-4",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white p-4 rounded shadow border border-gray-200",children:[e.jsx("div",{className:"bg-gray-50 text-gray-900 px-4 py-3 -mx-4 -mt-4 mb-4 rounded-t border-b border-gray-200",children:e.jsx("h1",{className:"text-base font-semibold tracking-tight",children:"Inbound - Recepci√≥n"})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Import Reference"}),e.jsx("input",{type:"text",value:l,onChange:e=>r(e.target.value.toUpperCase()),placeholder:"I.R.",required:!0,disabled:!!E})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Waybill"}),e.jsx("input",{type:"text",value:d,onChange:e=>o(e.target.value.toUpperCase()),placeholder:"W.B.",required:!0})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"form-label",children:"Item Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:c,onChange:e=>m(e.target.value.toUpperCase()),onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),q()),placeholder:"Escanear o Escribir",required:!0,disabled:!!E}),!E&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"btn-sap btn-secondary",onClick:()=>R(!0),title:"Escanear",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z"}),e.jsx("path",{d:"M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z"}),e.jsx("path",{d:"M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z"}),e.jsx("path",{d:"M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z"}),e.jsx("path",{d:"M12 9h2V8h-2z"})]})}),e.jsx("button",{type:"button",className:"btn-sap btn-secondary",onClick:q,disabled:N,children:N?"...":"üîç"})]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label",children:"Item Description"}),e.jsx("div",{className:"data-field",children:(null==u?void 0:u.description)||""})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Qty Received"}),e.jsx("input",{type:"number",ref:D,value:h,onChange:e=>p(e.target.value),required:!0,min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Bin (Original)"}),e.jsx("div",{className:"data-field",children:(null==u?void 0:u.binLocation)||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Relocate (New)"}),e.jsx("input",{type:"text",value:x,onChange:e=>b(e.target.value.toUpperCase()),placeholder:"(Opcional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Aditional Bins"}),e.jsx("div",{className:"data-field text-xs",children:(null==u?void 0:u.aditionalBins)||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"ABC Type"}),e.jsx("div",{className:"data-field",children:(null==u?void 0:u.itemType)||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"SIC Code"}),e.jsx("div",{className:"data-field",children:(null==u?void 0:u.sicCode)||""})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 border border-gray-300 rounded mb-4",children:[e.jsx("h3",{className:"text-xs font-bold uppercase text-gray-700 border-b-2 border-blue-600 pb-1 mb-3",children:"Resumen de Cantidades"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Qty Received"}),e.jsx("div",{className:"data-field",children:h||0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Qty Expected (GRN)"}),e.jsx("div",{className:"data-field",children:(null==u?void 0:u.defaultQtyGrn)||0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Difference"}),e.jsx("div",{className:"data-field font-bold "+(A<0?"text-red-600":A>0?"text-blue-600":""),children:A>0?`+${A}`:A})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"btn-sap btn-primary w-60 h-10",children:E?"Guardar Cambios":"A√±adir Registro"}),E&&e.jsx("button",{type:"button",onClick:L,className:"btn-sap btn-secondary w-60 h-10",children:"Cancelar"})]})]}),e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-center mb-3",children:"Vista Etiqueta"}),e.jsx("div",{className:"label-print-area",children:e.jsxs("div",{className:"label-container",children:[e.jsxs("div",{children:[e.jsx("img",{src:"/static/images/logoytpe_sandvik.png",alt:"Sandvik",className:"label-logo"}),e.jsx("p",{className:"label-item-code",children:(null==u?void 0:u.itemCode)||"ITEM CODE"}),e.jsx("p",{className:"label-item-description",children:(null==u?void 0:u.description)||"Item Description"}),e.jsxs("div",{className:"label-data-field",children:[e.jsx("span",{children:"Quantity Received"}),e.jsx("span",{children:h||1})]}),e.jsxs("div",{className:"label-data-field",children:[e.jsx("span",{children:"Product weight"}),e.jsx("span",{children:H})]}),e.jsxs("div",{className:"label-data-field",children:[e.jsx("span",{children:"Bin Location"}),e.jsx("span",{children:x||(null==u?void 0:u.binLocation)||"BIN"})]}),e.jsxs("div",{className:"label-data-field",children:[e.jsx("span",{children:"Reception Date"}),e.jsx("span",{children:(new Date).toLocaleDateString("es-CO",{year:"2-digit",month:"2-digit",day:"2-digit"})})]})]}),e.jsxs("div",{className:"label-bottom-section",children:[e.jsx("p",{className:"label-disclaimer",children:"All trademarks and logotypes appearing on this label are owned by Sandvik Group"}),e.jsx("div",{id:"qrCodeContainer",children:S?e.jsx("img",{src:S,alt:"QR"}):e.jsx("span",{className:"text-xs text-gray-400",children:"QR Code"})})]})]})}),e.jsx("div",{className:"w-full flex justify-center mt-4",children:e.jsx("button",{type:"button",onClick:()=>{const e=z.current;if(!e)return void alert("Error: No se encontr√≥ el marco de impresi√≥n.");const t=`\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <title>Etiqueta ${u?u.itemCode:""}</title>\n                <style>\n                    @page { size: 70mm 100mm; margin: 0; }\n                    html, body { \n                        width: 70mm; height: 100mm; margin: 0; padding: 0; \n                        overflow: hidden; background: white; \n                        font-family: Arial, sans-serif; \n                    }\n                    .label-container {\n                        width: 100%; height: 100%; box-sizing: border-box;\n                        padding: 3mm; display: flex; flex-direction: column;\n                        justify-content: space-between; overflow: hidden;\n                        border: 1px solid #d1d5db; /* Added border to match screen */\n                        border-radius: 4px; /* Slight radius matching screen */\n                    }\n                    .label-logo { max-width: 50%; max-height: 8mm; margin-bottom: 3mm; display: block; }\n                    .label-item-code { font-size: 14pt; font-weight: bold; margin: 0 0 1mm 0; line-height: 1.1; color: #1f2937; }\n                    .label-item-description { font-size: 12pt; font-weight: bold; margin: 0 0 5mm 0; line-height: 1.1; color: #1f2937; max-height: 20mm; overflow: hidden; }\n                    \n                    .label-data-field { \n                        display: grid; grid-template-columns: auto 1fr; gap: 8px; \n                        align-items: start; margin-bottom: 0.5mm; font-size: 9pt; line-height: 1.25;\n                    }\n                    .label-data-field span:first-child { font-weight: 500; color: #4b5563; }\n                    .label-data-field span:last-child { text-align: right; font-weight: normal; color: #1f2937; }\n                    \n                    .label-bottom-section { \n                        display: flex; align-items: flex-end; justify-content: space-between; \n                        margin-top: auto; padding-top: 2mm;\n                    }\n                    .label-disclaimer { font-size: 6pt; color: #6b7280; max-width: 65%; line-height: 1; margin: 0; text-align: left; }\n                    #qrCodeContainer { width: 25mm; height: 25mm; display: flex; justify-content: center; align-items: center; }\n                    #qrCodeContainer img { width: 100%; height: 100%; object-fit: contain; }\n                </style>\n            </head>\n            <body>\n                <div class="label-container">\n                    <div>\n                        <img src="/static/images/logoytpe_sandvik.png" alt="Sandvik" class="label-logo" />\n                        <div class="label-item-code">${(null==u?void 0:u.itemCode)||"CODE"}</div>\n                        <div class="label-item-description">${(null==u?void 0:u.description)||"Description"}</div>\n\n                        <div class="label-data-field">\n                            <span>Quantity Received</span>\n                            <span>${h||1}</span>\n                        </div>\n                        <div class="label-data-field">\n                            <span>Product weight</span>\n                            <span>${H}</span>\n                        </div>\n                        <div class="label-data-field">\n                            <span>Bin Location</span>\n                            <span>${x||(null==u?void 0:u.binLocation)||"BIN"}</span>\n                        </div>\n                        <div class="label-data-field">\n                            <span>Reception Date</span>\n                            <span>${(new Date).toLocaleDateString("es-CO",{year:"2-digit",month:"2-digit",day:"2-digit"})}</span>\n                        </div>\n                    </div>\n\n                    <div class="label-bottom-section">\n                        <p class="label-disclaimer">All trademarks and logotypes appearing on this label are owned by Sandvik Group</p>\n                        <div id="qrCodeContainer">\n                            ${S?`<img src="${S}" />`:""}\n                        </div>\n                    </div>\n                </div>\n                <script>\n                    window.onload = function() { setTimeout(function(){ window.print(); }, 200); }\n                <\/script>\n            </body>\n            </html>\n        `,a=e.contentWindow.document;a.open(),a.write(t),a.close()},className:"btn-sap btn-primary btn-print-label h-10",disabled:!u,children:"Imprimir Etiqueta"})})]})]})}),e.jsxs("div",{className:"bg-white border border-gray-300 rounded shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 text-gray-900 px-4 py-3 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-base font-semibold tracking-tight",children:"Registros de Inbound"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>window.location.href="/update",className:"h-8 px-4 text-xs font-medium bg-white text-gray-700 border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 hover:border-gray-400 transition-all duration-150 flex items-center justify-center",children:"Act. Archivos"}),e.jsxs("button",{onClick:()=>window.location.href="/api/inbound/export",className:"h-8 px-4 text-xs font-medium bg-emerald-600 text-white border border-emerald-700 rounded-md shadow-sm hover:bg-emerald-700 transition-all duration-150 flex items-center justify-center gap-1.5",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 011.414.586l2.914 2.914a1 1 0 01.586 1.414V19a2 2 0 01-2 2z"})}),"Exportar"]}),e.jsxs("select",{onChange:e=>B(e.target.value),className:"h-8 w-44 px-3 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-150 cursor-pointer",children:[e.jsx("option",{value:"",children:"-- Versi√≥n Actual --"}),j.map(t=>e.jsxs("option",{value:t,children:["Archivado: ",new Date(t).toLocaleString()]},t))]}),e.jsx("button",{onClick:async()=>{if(confirm("¬øArchivar registros actuales y limpiar base?"))try{await fetch("/api/inbound/archive",{method:"POST"}),B(),$()}catch(e){alert("Error")}},className:"h-8 px-4 text-xs font-medium bg-red-600 text-white border border-red-700 rounded-md shadow-sm hover:bg-red-700 transition-all duration-150 flex items-center justify-center",children:"Base Limpia"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs border-collapse",children:[e.jsx("thead",{className:"bg-slate-700 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1.5 text-left font-medium",children:"Ref"}),e.jsx("th",{className:"px-2 py-1.5 text-left font-medium",children:"Waybill"}),e.jsx("th",{className:"px-2 py-1.5 text-left font-medium",children:"Item Code"}),e.jsx("th",{className:"px-2 py-1.5 text-left font-medium",children:"Descripci√≥n"}),e.jsx("th",{className:"px-2 py-1.5 text-left font-medium",children:"Bin (Orig)"}),e.jsx("th",{className:"px-2 py-1.5 text-left font-medium",children:"Bin (New)"}),e.jsx("th",{className:"px-2 py-1.5 text-center font-medium",children:"Qty Rec"}),e.jsx("th",{className:"px-2 py-1.5 text-center font-medium",children:"Qty Exp"}),e.jsx("th",{className:"px-2 py-1.5 text-center font-medium",children:"Dif"}),e.jsx("th",{className:"px-2 py-1.5 text-left font-medium",children:"Fecha/Hora"}),e.jsx("th",{className:"px-2 py-1.5 text-center font-medium",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:0===f.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"11",className:"text-center py-4 text-gray-500",children:"No hay registros"})}):f.map((t,a)=>e.jsxs("tr",{className:(a%2==0?"bg-white":"bg-gray-50")+" hover:bg-blue-50 transition-colors",children:[e.jsx("td",{className:"px-2 py-1.5",children:t.importReference}),e.jsx("td",{className:"px-2 py-1.5",children:t.waybill}),e.jsx("td",{className:"px-2 py-1.5 font-mono",children:t.itemCode}),e.jsx("td",{className:"px-2 py-1.5 max-w-[180px] truncate",title:t.itemDescription,children:t.itemDescription}),e.jsx("td",{className:"px-2 py-1.5",children:t.binLocation}),e.jsx("td",{className:"px-2 py-1.5",children:t.relocatedBin}),e.jsx("td",{className:"px-2 py-1.5 text-center",children:t.qtyReceived}),e.jsx("td",{className:"px-2 py-1.5 text-center",children:t.qtyGrn}),e.jsx("td",{className:"px-2 py-1.5 text-center font-semibold "+(t.difference<0?"text-red-600":t.difference>0?"text-blue-600":"text-gray-600"),children:t.difference>0?`+${t.difference}`:t.difference}),e.jsx("td",{className:"px-2 py-1.5 text-gray-600 whitespace-nowrap",children:new Date(t.timestamp).toLocaleString("es-CO",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"px-2 py-1.5",children:e.jsxs("div",{className:"flex gap-1 justify-center",children:[e.jsx("button",{onClick:()=>(e=>{I(e.id),r(e.importReference),o(e.waybill),m(e.itemCode),p(e.qtyReceived),b(e.relocatedBin||""),fetch(`/api/find_item/${encodeURIComponent(e.itemCode)}/${encodeURIComponent(e.importReference)}`).then(e=>e.json()).then(e=>g(e))})(t),className:"w-6 h-6 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded flex items-center justify-center transition-colors",title:"Editar",children:"‚úé"}),e.jsx("button",{onClick:()=>(async e=>{if(confirm("¬øEliminar registro?"))try{await fetch(`/api/delete_log/${e}`,{method:"DELETE"}),B()}catch(t){alert("Error")}})(t.id),className:"w-6 h-6 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded flex items-center justify-center transition-colors",title:"Eliminar",children:"üóë"})]})})]},t.id))})]})})]})]}),e.jsx("iframe",{ref:z,title:"print-label-frame",style:{position:"fixed",top:"-1000px",left:"-1000px",width:"1px",height:"1px",border:"none"}}),C&&e.jsx(n,{onScan:e=>{const t=e.toUpperCase();m(t),R(!1),setTimeout(()=>U(t),200)},onClose:()=>R(!1)})]})};export{s as default};
