import{j as e}from"./index-CtfDg2Lg.js";import{e as t,r as i}from"./react-vendor-BFe66WFD.js";import{b as n}from"./qrcode-vendor-cb-SQVWm.js";import{S as a}from"./ScannerModal-CXFaW436.js";/* empty css              */import"./ui-vendor-i8Pm06Jj.js";const l=()=>{const{setTitle:l}=t();i.useEffect(()=>{l("Logix - Inbound")},[l]);const[s,r]=i.useState(""),[d,o]=i.useState(""),[c,m]=i.useState(""),[h,x]=i.useState(""),[p,b]=i.useState(""),[g,u]=i.useState(null),[f,v]=i.useState([]),[y,j]=i.useState([]),[w,N]=i.useState(!1),[C,k]=i.useState(!1),[S,E]=i.useState(null),[R,z]=i.useState(null),I=i.useRef(null),D=i.useRef(null);i.useEffect(()=>{B(),H()},[]),i.useEffect(()=>{(null==g?void 0:g.itemCode)?n.toDataURL(g.itemCode,{width:96,margin:1}).then(e=>E(e)).catch(e=>{}):E(null)},[g]);const B=async(e="")=>{try{const t=e?`/api/get_logs?version_date=${e}`:"/api/get_logs",i=await fetch(t);i.ok&&v(await i.json())}catch(t){}},H=async()=>{try{const e=await fetch("/api/inbound/versions");e.ok&&j(await e.json())}catch(e){}},$=async()=>{var e;if(c&&s){N(!0);try{const t=await fetch(`/api/find_item/${encodeURIComponent(c)}/${encodeURIComponent(s)}`),i=await t.json();t.ok?(u(i),R||x(""),null==(e=I.current)||e.focus()):(alert(i.error||"Item no encontrado"),u(null))}catch(t){alert("Error de conexi√≥n")}finally{N(!1)}}else alert("Ingrese Import Reference e Item Code")},q=()=>{z(null),m(""),x(""),b(""),u(null)},T=e=>{e&&s&&(N(!0),fetch(`/api/find_item/${encodeURIComponent(e)}/${encodeURIComponent(s)}`).then(e=>e.json()).then(e=>{var t;e.error?(alert(e.error),u(null)):(u(e),R||x(""),null==(t=I.current)||t.focus())}).catch(()=>alert("Error de conexi√≥n")).finally(()=>N(!1)))},A=g?parseInt(h||0)-(g.defaultQtyGrn||0):0,L=g?(parseFloat(g.weight||0)*parseInt(h||1)).toFixed(2):"N/A";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container-wrapper px-4 py-4",children:[e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),!g)return alert("Busque un item primero");const t={importReference:s.toUpperCase(),waybill:d.toUpperCase(),itemCode:g.itemCode,quantity:parseInt(h),relocatedBin:p.toUpperCase()};try{let e;if(e=R?await fetch(`/api/inbound/log/${R}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({waybill:t.waybill,qtyReceived:t.quantity,relocatedBin:t.relocatedBin})}):await fetch("/api/add_log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),e.ok)B(),q();else{const t=await e.json();alert(t.detail||t.error||"Error al guardar")}}catch(i){alert("Error de conexi√≥n")}},children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-4",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white p-4 rounded shadow border border-gray-200",children:[e.jsx("div",{className:"bg-gray-50 text-gray-900 px-4 py-3 -mx-4 -mt-4 mb-4 rounded-t border-b border-gray-200",children:e.jsx("h1",{className:"text-base font-semibold tracking-tight",children:"Inbound - Recepci√≥n"})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Import Reference"}),e.jsx("input",{type:"text",value:s,onChange:e=>r(e.target.value.toUpperCase()),placeholder:"I.R.",required:!0,disabled:!!R})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Waybill"}),e.jsx("input",{type:"text",value:d,onChange:e=>o(e.target.value.toUpperCase()),placeholder:"W.B.",required:!0})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"form-label",children:"Item Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:c,onChange:e=>m(e.target.value.toUpperCase()),onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),$()),placeholder:"Escanear o Escribir",required:!0,disabled:!!R}),!R&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"btn-sap btn-secondary",onClick:()=>k(!0),title:"Escanear",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z"}),e.jsx("path",{d:"M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z"}),e.jsx("path",{d:"M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z"}),e.jsx("path",{d:"M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z"}),e.jsx("path",{d:"M12 9h2V8h-2z"})]})}),e.jsx("button",{type:"button",className:"btn-sap btn-secondary",onClick:$,disabled:w,children:w?"...":"üîç"})]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label",children:"Item Description"}),e.jsx("div",{className:"data-field",children:(null==g?void 0:g.description)||""})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Qty Received"}),e.jsx("input",{type:"number",ref:I,value:h,onChange:e=>x(e.target.value),required:!0,min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Bin (Original)"}),e.jsx("div",{className:"data-field",children:(null==g?void 0:g.binLocation)||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Relocate (New)"}),e.jsx("input",{type:"text",value:p,onChange:e=>b(e.target.value.toUpperCase()),placeholder:"(Opcional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Aditional Bins"}),e.jsx("div",{className:"data-field text-xs",children:(null==g?void 0:g.aditionalBins)||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"ABC Type"}),e.jsx("div",{className:"data-field",children:(null==g?void 0:g.itemType)||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"SIC Code"}),e.jsx("div",{className:"data-field",children:(null==g?void 0:g.sicCode)||""})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 border border-gray-300 rounded mb-4",children:[e.jsx("h3",{className:"text-xs font-bold uppercase text-gray-700 border-b-2 border-blue-600 pb-1 mb-3",children:"Resumen de Cantidades"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Qty Received"}),e.jsx("div",{className:"data-field",children:h||0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Qty Expected (GRN)"}),e.jsx("div",{className:"data-field",children:(null==g?void 0:g.defaultQtyGrn)||0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Difference"}),e.jsx("div",{className:"data-field font-bold "+(A<0?"text-red-600":A>0?"text-blue-600":""),children:A>0?`+${A}`:A})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"btn-sap btn-primary w-60 h-10",children:R?"Guardar Cambios":"A√±adir Registro"}),R&&e.jsx("button",{type:"button",onClick:q,className:"btn-sap btn-secondary w-60 h-10",children:"Cancelar"})]})]}),e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-center mb-3",children:"Vista Etiqueta"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{style:{width:"70mm",height:"100mm",padding:"3.5mm",boxSizing:"border-box",background:"white",border:"1px solid #ccc",position:"relative",fontFamily:"Arial, sans-serif",overflow:"hidden"},children:[e.jsx("img",{src:"/static/images/logoytpe_sandvik.png",alt:"Sandvik",style:{height:"7mm",display:"block",marginBottom:"3.5mm"}}),e.jsx("div",{style:{fontSize:"12pt",fontWeight:"bold",lineHeight:1.2},children:(null==g?void 0:g.itemCode)||"ITEM CODE"}),e.jsx("div",{style:{fontSize:"12pt",fontWeight:"bold",lineHeight:1.2,marginBottom:"18mm"},children:(null==g?void 0:g.description)||"Description"}),e.jsxs("div",{style:{fontSize:"9pt",lineHeight:1.4,marginBottom:"9mm"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"28mm 1fr"},children:[e.jsx("div",{children:"Quantity/pack"}),e.jsxs("div",{children:[h||1," EA"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"28mm 1fr"},children:[e.jsx("div",{children:"Product weight"}),e.jsxs("div",{children:[L," kg"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"28mm 1fr"},children:[e.jsx("div",{children:"Packaging date"}),e.jsx("div",{children:(new Date).toLocaleDateString("es-CO",{year:"2-digit",month:"2-digit",day:"2-digit"})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"28mm 1fr"},children:[e.jsx("div",{children:"Bin location"}),e.jsx("div",{children:p||(null==g?void 0:g.binLocation)||"BIN"})]})]}),e.jsxs("div",{style:{position:"absolute",bottom:"3.5mm",left:"3.5mm",right:"3.5mm",display:"flex",justifyContent:"space-between",alignItems:"flex-end"},children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",justifyContent:"flex-end",height:"25mm"},children:e.jsx("p",{style:{fontSize:"7pt",margin:0,maxWidth:"40mm",lineHeight:1.1,color:"#000"},children:"All trademarks and logotypes appearing on this label are owned by Sandvik Group"})}),e.jsx("div",{style:{width:"25mm",height:"25mm"},children:S?e.jsx("img",{src:S,alt:"QR",style:{width:"100%",height:"100%",objectFit:"contain"}}):e.jsx("div",{className:"border border-gray-200 w-full h-full"})})]})]})}),e.jsx("div",{className:"w-full flex justify-center mt-4",children:e.jsx("button",{type:"button",onClick:()=>{const e=D.current;if(!e)return void alert("Error: No se encontr√≥ el marco de impresi√≥n.");const t=`\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <title>Etiqueta ${g?g.itemCode:""}</title>\n                <style>\n                    @page { size: 70mm 100mm; margin: 0; }\n                    html, body { \n                        width: 70mm; height: 100mm; margin: 0; padding: 0; \n                        overflow: hidden; background: white; \n                        font-family: Arial, sans-serif; \n                    }\n                    .label-container {\n                        width: 70mm; height: 100mm; \n                        box-sizing: border-box;\n                        padding: 3.5mm; \n                        position: relative;\n                        background: white;\n                    }\n                    .label-logo { \n                        height: 7mm; \n                        display: block; \n                        margin-bottom: 3.5mm; \n                    }\n                    \n                    /* Header */\n                    .label-item-code {\n                        font-size: 12pt; font-weight: bold; margin-bottom: 0;\n                        line-height: 1.2; color: #000;\n                    }\n                    .label-item-description {\n                        font-size: 12pt; font-weight: bold; margin-bottom: 18mm;\n                        line-height: 1.2; color: #000;\n                    }\n\n                    /* Data Table */\n                    .label-data-table {\n                        font-size: 9pt;\n                        line-height: 1.4;\n                        margin-bottom: 9mm;\n                    }\n                    .label-row {\n                        display: grid;\n                        grid-template-columns: 28mm 1fr;\n                        /* gap: 2mm; */\n                    }\n                    .label-label {\n                         font-weight: normal; color: #000;\n                    }\n                    .label-value {\n                         font-weight: normal; color: #000;\n                    }\n                    \n                    /* Footer */\n                    .label-footer { \n                        position: absolute; \n                        bottom: 3.5mm; \n                        left: 3.5mm; \n                        right: 3.5mm;\n                        display: flex; \n                        align-items: flex-end; \n                        justify-content: space-between; \n                    }\n                    \n                    .label-disclaimer { \n                        font-size: 7pt; \n                        color: #000; \n                        max-width: 40mm; \n                        line-height: 1.1; \n                        margin: 0; \n                    }\n                    \n                    #qrCodeContainer { \n                        width: 25mm; \n                        height: 25mm; \n                        display: flex; \n                        justify-content: center; \n                        align-items: center; \n                    }\n                    #qrCodeContainer img { width: 100%; height: 100%; object-fit: contain; }\n                </style>\n            </head>\n            <body>\n                <div class="label-container">\n                    \x3c!-- Logo --\x3e\n                    <img src="/static/images/logoytpe_sandvik.png" alt="Sandvik" class="label-logo" />\n                    \n                    \x3c!-- Header --\x3e\n                    <div class="label-item-code">${(null==g?void 0:g.itemCode)||"CODE"}</div>\n                    <div class="label-item-description">${(null==g?void 0:g.description)||"Description"}</div>\n\n                    \x3c!-- Data Grid --\x3e\n                    <div class="label-data-table">\n                        <div class="label-row">\n                            <div class="label-label">Quantity/pack</div>\n                            <div class="label-value">${h||1} EA</div>\n                        </div>\n                        <div class="label-row">\n                            <div class="label-label">Product weight</div>\n                            <div class="label-value">${L} kg</div>\n                        </div>\n                        <div class="label-row">\n                            <div class="label-label">Packaging date</div>\n                            <div class="label-value">${(new Date).toLocaleDateString("es-CO",{year:"2-digit",month:"2-digit",day:"2-digit"})}</div>\n                        </div>\n                        <div class="label-row">\n                            <div class="label-label">Bin location</div>\n                            <div class="label-value">${p||(null==g?void 0:g.binLocation)||"BIN"}</div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Footer --\x3e\n                    <div class="label-footer">\n                        <div style="display:flex; flex-direction:column; justify-content:flex-end; height: 25mm;">\n                             <p class="label-disclaimer">All trademarks and logotypes appearing on this label are owned by Sandvik Group</p>\n                        </div>\n                     \n                        <div id="qrCodeContainer">\n                            ${S?`<img src="${S}" />`:""}\n                        </div>\n                    </div>\n                </div>\n                <script>\n                    window.onload = function() { setTimeout(function(){ window.print(); }, 200); }\n                <\/script>\n            </body>\n            </html>\n        `,i=e.contentWindow.document;i.open(),i.write(t),i.close()},className:"btn-sap btn-primary btn-print-label h-10",disabled:!g,children:"Imprimir Etiqueta"})})]})]})}),e.jsxs("div",{className:"bg-white border border-gray-300 rounded shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 text-gray-900 px-4 py-3 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-base font-semibold tracking-tight",children:"Registros de Inbound"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>window.location.href="/update",className:"h-8 px-4 text-xs font-medium bg-white text-gray-700 border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 hover:border-gray-400 transition-all duration-150 flex items-center justify-center",children:"Act. Archivos"}),e.jsxs("button",{onClick:()=>window.location.href="/api/inbound/export",className:"h-8 px-4 text-xs font-medium bg-emerald-600 text-white border border-emerald-700 rounded-md shadow-sm hover:bg-emerald-700 transition-all duration-150 flex items-center justify-center gap-1.5",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 011.414.586l2.914 2.914a1 1 0 01.586 1.414V19a2 2 0 01-2 2z"})}),"Exportar"]}),e.jsxs("select",{onChange:e=>B(e.target.value),className:"h-8 w-44 px-3 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-150 cursor-pointer",children:[e.jsx("option",{value:"",children:"-- Versi√≥n Actual --"}),y.map(t=>e.jsxs("option",{value:t,children:["Archivado: ",new Date(t).toLocaleString()]},t))]}),e.jsx("button",{onClick:async()=>{if(confirm("¬øArchivar registros actuales y limpiar base?"))try{await fetch("/api/inbound/archive",{method:"POST"}),B(),H()}catch(e){alert("Error")}},className:"h-8 px-4 text-xs font-medium bg-red-600 text-white border border-red-700 rounded-md shadow-sm hover:bg-red-700 transition-all duration-150 flex items-center justify-center",children:"Base Limpia"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs border-collapse",children:[e.jsx("thead",{className:"bg-slate-700 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1.5 text-left font-medium",children:"Ref"}),e.jsx("th",{className:"px-2 py-1.5 text-left font-medium",children:"Waybill"}),e.jsx("th",{className:"px-2 py-1.5 text-left font-medium",children:"Item Code"}),e.jsx("th",{className:"px-2 py-1.5 text-left font-medium",children:"Descripci√≥n"}),e.jsx("th",{className:"px-2 py-1.5 text-left font-medium",children:"Bin (Orig)"}),e.jsx("th",{className:"px-2 py-1.5 text-left font-medium",children:"Bin (New)"}),e.jsx("th",{className:"px-2 py-1.5 text-center font-medium",children:"Qty Rec"}),e.jsx("th",{className:"px-2 py-1.5 text-center font-medium",children:"Qty Exp"}),e.jsx("th",{className:"px-2 py-1.5 text-center font-medium",children:"Dif"}),e.jsx("th",{className:"px-2 py-1.5 text-left font-medium",children:"Fecha/Hora"}),e.jsx("th",{className:"px-2 py-1.5 text-center font-medium",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:0===f.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"11",className:"text-center py-4 text-gray-500",children:"No hay registros"})}):f.map((t,i)=>e.jsxs("tr",{className:(i%2==0?"bg-white":"bg-gray-50")+" hover:bg-blue-50 transition-colors",children:[e.jsx("td",{className:"px-2 py-1.5",children:t.importReference}),e.jsx("td",{className:"px-2 py-1.5",children:t.waybill}),e.jsx("td",{className:"px-2 py-1.5 font-mono",children:t.itemCode}),e.jsx("td",{className:"px-2 py-1.5 max-w-[180px] truncate",title:t.itemDescription,children:t.itemDescription}),e.jsx("td",{className:"px-2 py-1.5",children:t.binLocation}),e.jsx("td",{className:"px-2 py-1.5",children:t.relocatedBin}),e.jsx("td",{className:"px-2 py-1.5 text-center",children:t.qtyReceived}),e.jsx("td",{className:"px-2 py-1.5 text-center",children:t.qtyGrn}),e.jsx("td",{className:"px-2 py-1.5 text-center font-semibold "+(t.difference<0?"text-red-600":t.difference>0?"text-blue-600":"text-gray-600"),children:t.difference>0?`+${t.difference}`:t.difference}),e.jsx("td",{className:"px-2 py-1.5 text-gray-600 whitespace-nowrap",children:new Date(t.timestamp).toLocaleString("es-CO",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"px-2 py-1.5",children:e.jsxs("div",{className:"flex gap-1 justify-center",children:[e.jsx("button",{onClick:()=>(e=>{z(e.id),r(e.importReference),o(e.waybill),m(e.itemCode),x(e.qtyReceived),b(e.relocatedBin||""),fetch(`/api/find_item/${encodeURIComponent(e.itemCode)}/${encodeURIComponent(e.importReference)}`).then(e=>e.json()).then(e=>u(e))})(t),className:"w-6 h-6 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded flex items-center justify-center transition-colors",title:"Editar",children:"‚úé"}),e.jsx("button",{onClick:()=>(async e=>{if(confirm("¬øEliminar registro?"))try{await fetch(`/api/delete_log/${e}`,{method:"DELETE"}),B()}catch(t){alert("Error")}})(t.id),className:"w-6 h-6 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded flex items-center justify-center transition-colors",title:"Eliminar",children:"üóë"})]})})]},t.id))})]})})]})]}),e.jsx("iframe",{ref:D,title:"print-label-frame",style:{position:"fixed",top:"-1000px",left:"-1000px",width:"1px",height:"1px",border:"none"}}),C&&e.jsx(a,{onScan:e=>{const t=e.toUpperCase();m(t),k(!1),setTimeout(()=>T(t),200)},onClose:()=>k(!1)})]})};export{l as default};
