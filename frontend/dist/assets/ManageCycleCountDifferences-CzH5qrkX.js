import{j as e}from"./index-wQJwC0jU.js";import{e as s,r as a}from"./react-vendor-BFe66WFD.js";import{y as t,L as r}from"./ui-vendor-i8Pm06Jj.js";/* empty css                      */const l=()=>{const{setTitle:l}=s(),[c,d]=a.useState(!1),[n,i]=a.useState([]),[x,o]=a.useState(""),[m,p]=a.useState(""),[h,j]=a.useState(""),[y,b]=a.useState(!0),[u,f]=a.useState(!1),[g,N]=a.useState(null),[v,w]=a.useState("");a.useEffect(()=>{l("Logix - Gestión de Diferencias"),_()},[l]);const _=async()=>{d(!0);try{const e=new URLSearchParams;x&&e.append("year",x),m&&e.append("month",m),e.append("only_differences",y);const s=await fetch(`/api/planner/cycle_count_differences?${e.toString()}`);if(s.ok){let e=await s.json();h&&(e=e.filter(e=>e.item_code.includes(h.toUpperCase()))),i(e)}else t.error("Error cargando diferencias")}catch(e){t.error("Error de conexión")}finally{d(!1)}};return e.jsxs("div",{className:"container-wrapper max-w-6xl mx-auto px-4 py-6",children:[e.jsx(r,{position:"top-right",autoClose:3e3}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-xl font-normal text-gray-800 mb-2",children:"Gestión de Diferencias"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Verifique y edite las cantidades encontradas en los conteos cíclicos"})]}),e.jsxs("div",{className:"flex flex-wrap items-end gap-4 mb-6 bg-white p-4 rounded shadow-sm border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label text-xs",children:"Año"}),e.jsx("input",{type:"number",value:x,onChange:e=>o(e.target.value),className:"w-24 p-1 border rounded",placeholder:"YYYY"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label text-xs",children:"Mes"}),e.jsxs("select",{value:m,onChange:e=>p(e.target.value),className:"w-32 p-1 border rounded",children:[e.jsx("option",{value:"",children:"Todos"}),[...Array(12)].map((s,a)=>e.jsx("option",{value:a+1,children:new Date(0,a).toLocaleString("es",{month:"long"})},a))]})]}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("label",{className:"form-label text-xs",children:"Código Item"}),e.jsx("input",{type:"text",value:h,onChange:e=>j(e.target.value),className:"w-full p-1 border rounded uppercase",placeholder:"Buscar..."})]}),e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:e=>b(e.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Solo diferencias"})]}),e.jsx("button",{onClick:_,className:"btn-sap btn-primary text-xs py-2 px-4 h-[34px]",children:"Filtrar"})]}),e.jsx("div",{className:"bg-white shadow rounded overflow-hidden border border-gray-200",children:c?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Cargando..."}):0===n.length?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No se encontraron registros"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"font-semibold uppercase text-xs border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3",children:"Item"}),e.jsx("th",{className:"px-4 py-3",children:"Descripción"}),e.jsx("th",{className:"px-4 py-3",children:"Ubicación"}),e.jsx("th",{className:"px-4 py-3",children:"ABC"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Sis"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Físico"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Dif"}),e.jsx("th",{className:"px-4 py-3",children:"Usuario"}),e.jsx("th",{className:"px-4 py-3",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:n.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-xs",children:s.executed_date}),e.jsx("td",{className:"px-4 py-2 font-medium",children:s.item_code}),e.jsx("td",{className:"px-4 py-2 text-xs truncate max-w-[200px]",title:s.item_description,children:s.item_description}),e.jsx("td",{className:"px-4 py-2",children:s.bin_location}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:"px-2 py-0.5 rounded text-[10px] font-bold "+("A"===s.abc_code?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:s.abc_code})}),e.jsx("td",{className:"px-4 py-2 text-right",children:s.system_qty}),e.jsx("td",{className:"px-4 py-2 text-right font-bold",children:s.physical_qty}),e.jsxs("td",{className:"px-4 py-2 text-right font-bold "+(0!==s.difference?"text-red-500":"text-gray-400"),children:[s.difference>0?"+":"",s.difference]}),e.jsx("td",{className:"px-4 py-2 text-xs text-gray-500",children:s.username}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("button",{onClick:()=>(e=>{N(e),w(e.physical_qty),f(!0)})(s),className:"text-blue-600 hover:text-blue-800 text-xs font-semibold border border-blue-200 px-2 py-1 rounded bg-blue-50",children:"Editar"})})]},s.id))})]})})}),u&&g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-sm w-full p-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4 text-gray-800",children:"Editar Cantidad"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Item"}),e.jsx("div",{className:"p-2 bg-gray-50 border rounded text-sm text-gray-600",children:g.item_code})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Cantidad Sistema"}),e.jsx("div",{className:"p-2 bg-gray-50 border rounded text-sm text-gray-600",children:g.system_qty})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Cantidad Física (Nueva)"}),e.jsx("input",{type:"number",value:v,onChange:e=>w(e.target.value),className:"w-full p-2 border rounded font-bold text-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Diferencia Resultante"}),e.jsx("div",{className:"p-2 border rounded text-sm font-bold "+(parseInt(v)-g.system_qty!==0?"text-red-600 bg-red-50":"text-green-600 bg-green-50"),children:parseInt(v)-g.system_qty})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>f(!1),className:"btn-sap btn-secondary",children:"Cancelar"}),e.jsx("button",{onClick:async()=>{if(g)try{(await fetch(`/api/planner/cycle_count_differences/${g.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({physical_qty:parseInt(v)})})).ok?(t.success("Cantidad actualizada"),f(!1),_()):t.error("Error al guardar")}catch(e){t.error("Error de conexión")}},className:"btn-sap btn-primary",children:"Guardar"})]})]})})]})};export{l as default};
