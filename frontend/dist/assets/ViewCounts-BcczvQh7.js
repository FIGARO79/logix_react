import{j as e}from"./index-D2N3aOe4.js";import{h as t,e as s,r}from"./react-vendor-BFe66WFD.js";const a=()=>{const a=t(),{setTitle:o}=s(),[i,n]=r.useState([]),[l,d]=r.useState(!0),[c,x]=r.useState(null),[m,h]=r.useState([]),[p,b]=r.useState({total_items_with_stock:"-",total_items_counted:"-",items_with_differences:"-",items_with_positive_differences:"-",items_with_negative_differences:"-",total_locations_with_stock:"-",counted_locations:"-"}),[f,u]=r.useState([]),[v,j]=r.useState("");r.useEffect(()=>{o("Control de Conteos")},[o]);const w=async()=>{d(!0);try{const e=await fetch("/api/counts/all");if(!e.ok)throw new Error("Error loading counts");const t=await e.json();n(t),h(t);const s=[...new Set(t.map(e=>e.username).filter(Boolean))];u(s);const r=await fetch("/api/counts/stats");if(r.ok){const e=await r.json();b(e)}}catch(e){x(e.message)}finally{d(!1)}};r.useEffect(()=>{w()},[]),r.useEffect(()=>{h(v?i.filter(e=>e.username===v):i)},[v,i]);return e.jsxs("div",{className:"max-w-[1920px] mx-auto px-4 py-6 font-sans text-sm text-[#32363a]",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-xl font-normal text-[#32363a] mb-1",children:"Control de Conteos"}),e.jsx("p",{className:"text-sm text-[#6a6d70]",children:"Visualiza y analiza los conteos del inventario"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4 mb-8",children:[{title:"Items con Stock",val:p.total_items_with_stock,color:"text-[#6a6d70]"},{title:"Items Contados",val:p.total_items_counted,color:"text-[#107e3e]"},{title:"Items con Diferencia",val:p.items_with_differences,color:"text-[#e9730c]"},{title:"Dif. Positiva",val:p.items_with_positive_differences,color:"text-[#0a6ed1]"},{title:"Dif. Negativa",val:p.items_with_negative_differences,color:"text-[#b00]"},{title:"Ubic. en uso",val:p.total_locations_with_stock,color:"text-[#6a6d70]"},{title:"Ubic. Contadas",val:p.counted_locations,color:"text-[#0a6ed1]"}].map((t,s)=>e.jsxs("div",{className:"bg-white border border-[#d9d9d9] rounded p-4 text-center shadow-[0_0_0_1px_rgba(0,0,0,0.05)] hover:-translate-y-0.5 hover:shadow-[0_2px_8px_0_rgba(0,0,0,0.15)] transition-all",children:[e.jsx("h3",{className:`text-xs font-semibold uppercase tracking-wider mb-2 ${t.color}`,children:t.title}),e.jsx("p",{className:`text-2xl font-bold ${t.color}`,children:t.val})]},s))}),e.jsxs("div",{className:"flex justify-between items-center mb-6 p-3 bg-white rounded border border-[#d9d9d9]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm font-normal text-[#32363a]",children:"Filtrar usuario:"}),e.jsxs("select",{value:v,onChange:e=>j(e.target.value),className:"h-9 border border-[#89919a] rounded px-2 bg-white text-[#32363a] focus:border-[#0a6ed1] focus:ring-1 focus:ring-[#0a6ed1] outline-none",children:[e.jsx("option",{value:"",children:"Todos"}),f.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs("a",{href:"/api/export_counts?tz=America/Bogota",className:"inline-flex items-center px-4 py-2 border border-[#0854a0] text-[#0a6ed1] bg-white text-sm font-medium rounded hover:bg-[#ebf5fe] transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Exportar"]})})]}),e.jsxs("div",{className:"bg-white shadow-sm rounded border border-[#d9d9d9] overflow-hidden",children:[e.jsxs("div",{className:"bg-[#f2f2f2] px-4 py-3 border-b border-[#e5e5e5] flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2 text-[#32363a]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("h2",{className:"text-sm font-semibold text-[#32363a]",children:"Detalle de Conteos"})]}),e.jsx("div",{className:"overflow-x-auto max-h-[70vh]",children:e.jsxs("table",{className:"min-w-full text-left border-collapse",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsx("tr",{children:["Etapa","ID Sesión","Usuario","Timestamp","Item Code","Descripción","Ubic. Contada","Cant. Sistema","Cant. Contada","Diferencia","Ubic. Sistema","Acciones"].map((t,s)=>e.jsx("th",{className:"px-4 py-2 border-b border-[#e5e5e5] text-xs font-semibold uppercase tracking-wider whitespace-nowrap",children:t},s))})}),e.jsx("tbody",{className:"divide-y divide-[#e5e5e5]",children:l?e.jsx("tr",{children:e.jsx("td",{colSpan:"12",className:"p-8 text-center text-gray-500",children:"Cargando..."})}):0===m.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"12",className:"p-12 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("svg",{className:"h-12 w-12 text-gray-300 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("p",{className:"font-medium",children:"No hay registros de conteo"})]})})}):m.map(t=>{return e.jsxs("tr",{className:"hover:bg-[#f5f5f5] transition-colors",children:[e.jsx("td",{className:"px-4 py-2 border-b border-[#e5e5e5] text-sm",children:t.inventory_stage||"-"}),e.jsx("td",{className:"px-4 py-2 border-b border-[#e5e5e5] text-sm",children:t.session_id}),e.jsx("td",{className:"px-4 py-2 border-b border-[#e5e5e5] text-sm font-medium",children:t.username||"-"}),e.jsx("td",{className:"px-4 py-2 border-b border-[#e5e5e5] text-xs text-gray-600 whitespace-nowrap",children:t.timestamp}),e.jsx("td",{className:"px-4 py-2 border-b border-[#e5e5e5] text-sm font-bold",children:t.item_code}),e.jsx("td",{className:"px-4 py-2 border-b border-[#e5e5e5] text-sm text-gray-600 truncate max-w-[200px]",title:t.item_description,children:t.item_description}),e.jsx("td",{className:"px-4 py-2 border-b border-[#e5e5e5] text-sm",children:t.counted_location}),e.jsx("td",{className:"px-4 py-2 border-b border-[#e5e5e5] text-sm font-medium",children:null!==t.system_qty?t.system_qty:"-"}),e.jsx("td",{className:"px-4 py-2 border-b border-[#e5e5e5] text-sm",children:t.counted_qty}),e.jsx("td",{className:"px-4 py-2 border-b border-[#e5e5e5] text-sm font-bold",children:e.jsx("span",{className:(s=t.difference,null==s?"text-gray-700":s>0?"text-blue-600":s<0?"text-red-600":"text-gray-700"),children:null!==t.difference?t.difference:"-"})}),e.jsx("td",{className:"px-4 py-2 border-b border-[#e5e5e5] text-sm text-gray-600",children:t.bin_location_system||"-"}),e.jsxs("td",{className:"px-4 py-2 border-b border-[#e5e5e5] text-center flex gap-1",children:[e.jsx("button",{onClick:()=>a(`/counts/edit/${t.id}`),title:"Editar",className:"text-indigo-600 hover:bg-indigo-50 p-1 rounded",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>(async e=>{if(window.confirm("¿Eliminar este conteo permanentemente?"))try{if(!(await fetch(`/api/counts/${e}`,{method:"DELETE"})).ok)throw new Error("Error deleting");w()}catch(t){alert(t.message)}})(t.id),title:"Eliminar",className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},t.id);var s})})]})})]})]})};export{a as default};
