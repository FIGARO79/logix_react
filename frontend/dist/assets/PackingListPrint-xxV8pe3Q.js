import{j as e}from"./index-BYgTg5Ia.js";import{i as t,h as n,r as a,R as s}from"./react-vendor-BFe66WFD.js";const r=()=>{const{id:r}=t(),i=n(),[d,l]=a.useState(null),[o,c]=a.useState(!0),[p,x]=a.useState(null),g=s.useRef(null);if(a.useEffect(()=>{(async()=>{try{const e=await fetch(`/api/picking/packing_list/${r}`,{credentials:"include"});if(!e.ok)throw new Error("Error loading data");const t=await e.json();l(t)}catch(e){x(e.message)}finally{c(!1)}})();const e=document.querySelector('link[href*="sap_fiori_3"]');return e&&(e.disabled=!0),()=>{e&&(e.disabled=!1)}},[r]),o)return e.jsx("div",{className:"p-8",children:"Generando Packing List..."});if(p)return e.jsxs("div",{className:"p-8 text-red-600",children:["Error: ",p]});if(!d)return e.jsx("div",{className:"p-8",children:"No datos."});const{packages:m}=d,h=Object.keys(m).sort((e,t)=>parseInt(e)-parseInt(t));return e.jsxs("div",{className:"bg-white min-h-screen text-black p-8 font-sans",children:[e.jsx("div",{className:"no-print mb-6 sticky top-0 bg-white border-b shadow-sm z-10",children:e.jsxs("div",{className:"max-w-3xl mx-auto flex justify-between items-center p-4",children:[e.jsx("h1",{className:"text-lg font-bold",children:"Vista Previa Packing List"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>i(-1),className:"bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300",children:"Cerrar"}),e.jsx("button",{onClick:()=>{const e=g.current;if(!e)return void alert("Error: No se encontró el marco de impresión.");const{packages:t}=d,n=Object.keys(t).sort((e,t)=>parseInt(e)-parseInt(t)),a=`\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <title>Packing List - ${d.order_number}</title>\n                <style>\n                    body { font-family: Arial, sans-serif; padding: 0; margin: 0; color: black; }\n                    .package-page { padding: 40px; box-sizing: border-box; height: 100vh; position: relative; }\n                    .header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #ddd; padding-bottom: 10px; }\n                    .header h1 { margin: 0; font-size: 24px; color: #0a6ed1; }\n                    .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; font-size: 14px; }\n                    .package-content { border: 1px solid #ccc; margin-bottom: 20px; }\n                    .package-header { background: #f0f0f0; padding: 10px; font-weight: bold; border-bottom: 1px solid #ccc; display: flex; justify-content: space-between; }\n                    table { width: 100%; border-collapse: collapse; font-size: 12px; }\n                    th { text-align: left; padding: 8px; border-bottom: 1px solid #ddd; background: #fafafa; }\n                    td { padding: 8px; border-bottom: 1px solid #eee; }\n                    .text-right { text-align: right; }\n                    @media print {\n                        .no-print { display: none; }\n                        @page { margin: 0; size: A4; }\n                        body { -webkit-print-color-adjust: exact; }\n                        .package-header { background: #f0f0f0 !important; }\n                        .package-page { height: auto; page-break-after: always; padding: 1cm; }\n                        .package-page:last-child { page-break-after: auto; }\n                    }\n                </style>\n            </head>\n            <body>\n                ${n.map((e,a)=>`\n                    <div class="package-page" style="${a<n.length-1?"page-break-after: always;":""}">\n                        <div class="header">\n                            <h1>PACKING LIST</h1>\n                            <div>${d.timestamp}</div>\n                        </div>\n\n                        <div class="info-grid">\n                            <div>\n                                <strong>CLIENTE:</strong><br>${d.customer_name}\n                            </div>\n                            <div class="text-right">\n                                <strong>BULTO:</strong><br><span style="font-size: 1.2em; font-weight: bold;">${e}</span> / ${d.total_packages}\n                            </div>\n                            <div>\n                                <strong>PEDIDO:</strong><br>${d.order_number}\n                            </div>\n                            <div class="text-right">\n                                <strong>DESPACHO:</strong><br>${d.despatch_number}\n                            </div>\n                        </div>\n\n                        <div class="package-content">\n                            <div class="package-header">\n                                <span>CONTENIDO BULTO #${e}</span>\n                                <span>BOX-${e.padStart(3,"0")}</span>\n                            </div>\n                            <table>\n                                <thead>\n                                    <tr>\n                                        <th>CÓDIGO</th>\n                                        <th>DESCRIPCIÓN</th>\n                                        <th class="text-right">CANTIDAD</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    ${t[e].map(e=>`\n                                        <tr>\n                                            <td>${e.item_code}</td>\n                                            <td>${e.description}</td>\n                                            <td class="text-right">${e.quantity}</td>\n                                        </tr>\n                                    `).join("")}\n                                </tbody>\n                            </table>\n                        </div>\n                        \n                        <div style="margin-top: 30px; text-align: center; font-size: 10px; color: #999;">\n                            Página ${a+1} de ${n.length}\n                        </div>\n                    </div>\n                `).join("")}\n            </body>\n            </html>\n        `,s=e.contentWindow.document;s.open(),s.write(a),s.close(),e.contentWindow.focus(),setTimeout(()=>{e.contentWindow.print()},500)},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 font-bold",children:"Imprimir"})]})]})}),e.jsxs("div",{id:"printable-section",className:"max-w-3xl mx-auto border p-8 bg-white",children:[e.jsxs("div",{className:"text-center mb-8 border-b pb-4",children:[e.jsx("h1",{className:"text-3xl font-extrabold uppercase tracking-wide mb-2",children:"Packing List"}),e.jsx("div",{className:"text-sm text-gray-500",children:d.timestamp})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-8 mb-8 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-500 uppercase text-xs",children:"Cliente"}),e.jsx("p",{className:"text-lg font-semibold",children:d.customer_name})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-gray-500 uppercase text-xs",children:"Total Bultos"}),e.jsx("p",{className:"text-lg font-semibold",children:d.total_packages})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-500 uppercase text-xs",children:"Pedido"}),e.jsx("p",{className:"text-lg",children:d.order_number})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-gray-500 uppercase text-xs",children:"Despacho"}),e.jsx("p",{className:"text-lg",children:d.despatch_number})]})]}),e.jsx("div",{className:"space-y-6",children:0===h.length?e.jsx("p",{className:"text-center text-gray-500 italic py-8",children:"No hay items asignados a bultos."}):h.map(t=>e.jsxs("div",{className:"page-break border rounded-lg break-inside-avoid shadow-sm print:shadow-none print:border-gray-300",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 border-b flex justify-between items-center print:bg-gray-50",children:[e.jsxs("h3",{className:"font-bold text-lg",children:["Bulto #",t]}),e.jsxs("span",{className:"text-xs text-gray-500 font-mono",children:["BOX-",t.padStart(3,"0")]})]}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left w-1/4",children:"Código"}),e.jsx("th",{className:"px-4 py-2 text-left w-1/2",children:"Descripción"}),e.jsx("th",{className:"px-4 py-2 text-right w-1/4",children:"Cantidad"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:m[t].map((t,n)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 font-mono text-gray-700",children:t.item_code}),e.jsx("td",{className:"px-4 py-2 text-gray-600 truncate max-w-xs",children:t.description}),e.jsx("td",{className:"px-4 py-2 text-right font-bold",children:t.quantity})]},n))})]})]},t))}),e.jsx("div",{className:"mt-12 pt-8 border-t text-center text-xs text-gray-400",children:e.jsx("p",{children:"Logix - Sistema de Gestión de Almacén"})})]}),e.jsx("iframe",{ref:g,title:"print-frame",style:{position:"fixed",top:"-1000px",left:"-1000px",width:"1px",height:"1px",border:"none"}})]})};export{r as default};
