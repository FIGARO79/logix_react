const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/qrcode-vendor-ClTz9A3x.js","assets/react-vendor-BFe66WFD.js"])))=>i.map(i=>d[i]);
import{_ as e,j as t}from"./index-wQJwC0jU.js";import{e as s,r as a}from"./react-vendor-BFe66WFD.js";import{y as r,L as n}from"./ui-vendor-i8Pm06Jj.js";/* empty css                      */const c=(e,t)=>{try{const s=new(window.AudioContext||window.webkitAudioContext),a=s.createOscillator(),r=s.createGain();a.connect(r),r.connect(s.destination),a.frequency.value=e,a.type=e>600?"sine":"square",r.gain.setValueAtTime(.3,s.currentTime),r.gain.exponentialRampToValueAtTime(.01,s.currentTime+t),a.start(s.currentTime),a.stop(s.currentTime+t)}catch(s){}},l=()=>c(200,.2),i=()=>{const{setTitle:i}=s(),[d,o]=a.useState(""),[x,h]=a.useState(""),[m,u]=a.useState(!1),[b,p]=a.useState([]),[j,f]=a.useState(!1),[g,y]=a.useState(""),[v,N]=a.useState([]),[w,C]=a.useState(""),[_,q]=a.useState(!1),[k,z]=a.useState(!1),S=a.useRef(null),[A,H]=a.useState(!1),[I,E]=a.useState(!1),[D,T]=a.useState(!1),[F,M]=a.useState(""),[O,V]=a.useState({});a.useEffect(()=>{i("Logix - Chequeo de Picking"),P()},[i]);const P=async()=>{try{const e=await fetch("/api/picking/tracking",{credentials:"include"});e.ok&&p(await e.json())}catch(e){}},L=()=>{f(!1),N([]),o(""),h(""),y(""),T(!1),V({}),M(""),P()},B=e=>{const t=e.trim().toUpperCase();if(!t)return;let s=v.findIndex(e=>e.code===t&&e.qty_scan<e.qty_req);if(-1===s&&(s=v.findIndex(e=>e.code===t)),s>-1){const e=[...v],t=e[s];t.qty_scan+=1,t.difference=t.qty_scan-t.qty_req,N(e),C(""),t.qty_scan<=t.qty_req?(c(800,.1),r.success(`Leído: ${t.code}`)):(l(),r.warning(`Exceso: ${t.code}`))}else l(),r.error(`Item NO pertenece al pedido: ${t}`)},R=()=>{v.some(e=>e.qty_scan!==e.qty_req)?H(!0):E(!0)},$=async e=>{const t={order_number:d,despatch_number:x,customer_name:g,status:v.some(e=>e.qty_scan!==e.qty_req)?"Con Diferencia":"Completo",items:v.map(e=>({code:e.code,description:e.description,order_line:e.order_line,qty_req:e.qty_req,qty_scan:e.qty_scan})),packages:parseInt(F||0),packages_assignment:O};try{const e=await fetch("/api/save_picking_audit",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(e.ok)r.success("Auditoría Finalizada Correctamente"),L(),H(!1),E(!1),T(!1),M("");else{const t=await e.json();r.error(t.detail||"Error al guardar")}}catch(s){r.error("Error de conexión")}};a.useEffect(()=>{if(_){let t;return e(async()=>{const{Html5Qrcode:e}=await import("./qrcode-vendor-ClTz9A3x.js").then(e=>e.i);return{Html5Qrcode:e}},__vite__mapDeps([0,1])).then(({Html5Qrcode:e})=>{t=new e("audit-reader"),S.current=t,t.start({facingMode:"environment"},{fps:10,qrbox:250},e=>{t.stop().then(()=>{try{t.clear()}catch(s){}q(!1),S.current=null,B(e)}).catch(()=>q(!1))},e=>{}).catch(e=>{q(!1),r.error("Cámara no disponible")})}),()=>{if(t)try{t.stop().catch(()=>{});try{t.clear()}catch(e){}}catch(e){}}}},[_]);const Q=()=>{S.current&&S.current.applyVideoConstraints({advanced:[{torch:!k}]}).then(()=>z(!k)).catch(e=>{r.error("Flash no disponible")})};return j?t.jsxs("div",{className:"container-wrapper max-w-5xl mx-auto px-4 py-4",children:[t.jsx(n,{position:"top-right",autoClose:2e3}),t.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-200",children:[t.jsxs("div",{className:"flex justify-between items-start mb-6 border-b pb-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Auditoría en Curso"}),t.jsxs("p",{className:"text-gray-600",children:["Orden: ",t.jsxs("span",{className:"font-mono font-bold text-black",children:[d," / ",x]})]}),t.jsxs("p",{className:"text-gray-600",children:["Cliente: ",t.jsx("span",{className:"font-bold text-black",children:g})]})]}),t.jsx("button",{onClick:L,className:"btn-sap btn-secondary text-xs",children:"Cancelar / Salir"})]}),t.jsxs("div",{className:"mb-6 flex gap-2",children:[t.jsxs("div",{className:"flex-grow",children:[t.jsx("label",{className:"form-label",children:"Item Code (Scan)"}),t.jsx("input",{type:"text",value:w,onChange:e=>C(e.target.value.toUpperCase()),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),B(w))},className:"w-full uppercase",placeholder:"Escanear o escribir...",autoFocus:!0})]}),t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsx("button",{onClick:()=>q(!0),className:"btn-sap btn-secondary h-[38px] px-3",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[t.jsx("path",{d:"M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z"}),t.jsx("path",{d:"M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z"}),t.jsx("path",{d:"M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z"}),t.jsx("path",{d:"M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z"}),t.jsx("path",{d:"M12 9h2V8h-2z"})]})}),t.jsx("button",{onClick:()=>B(w),className:"btn-sap btn-secondary h-[38px]",children:"Buscar"})]})]}),t.jsx("div",{className:"overflow-x-auto border border-gray-300 rounded mb-6",children:t.jsxs("table",{className:"w-full text-left sap-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Item"}),t.jsx("th",{children:"Descripción"}),t.jsx("th",{className:"text-center w-16",children:"Req"}),t.jsx("th",{className:"text-center w-16",children:"Scan"}),t.jsx("th",{className:"text-center w-16",children:"Dif"})]})}),t.jsx("tbody",{children:v.map((e,s)=>{const a=e.qty_scan-e.qty_req,r=e.qty_scan===e.qty_req,n=e.qty_scan>e.qty_req;return t.jsxs("tr",{className:r?"bg-green-50":n?"bg-red-50":"",children:[t.jsx("td",{className:"font-medium",children:e.code}),t.jsx("td",{className:"text-sm truncate max-w-[200px]",children:e.description}),t.jsx("td",{className:"text-center",children:e.qty_req}),t.jsx("td",{className:"text-center font-bold",children:e.qty_scan}),t.jsx("td",{className:"text-center font-bold "+(0!==a?"text-red-600":"text-green-600"),children:a>0?`+${a}`:a})]},s)})})]})}),t.jsx("button",{onClick:R,className:"btn-sap btn-primary w-full py-3 text-lg",children:"Finalizar Auditoría"})]}),_&&t.jsx("div",{className:"fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg",children:[t.jsx("h3",{className:"text-center font-bold text-lg mb-4 text-gray-800",children:"Escanear Código"}),t.jsx("div",{id:"audit-reader",className:"rounded-lg overflow-hidden mb-4 border-2 border-gray-100"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("button",{onClick:Q,className:"flex-1 h-12 flex items-center justify-center gap-2 rounded bg-[#34495e] hover:bg-[#2c3e50] text-white font-medium transition-colors "+(k?"ring-2 ring-yellow-400":""),title:k?"Apagar Flash":"Encender Flash",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",viewBox:"0 0 16 16",children:t.jsx("path",{d:"M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a1.964 1.964 0 0 0-.453-.618A5.984 5.984 0 0 1 2 6zm6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1z"})}),"Flash"]}),t.jsx("button",{onClick:()=>{S.current?S.current.stop().then(()=>{try{S.current.clear()}catch(e){}q(!1),S.current=null}).catch(()=>q(!1)):q(!1)},className:"flex-1 h-12 flex items-center justify-center bg-[#d32f2f] hover:bg-[#b71c1c] text-white font-medium rounded transition-colors",children:"Cancelar"})]})]})}),A&&t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-sm w-full",children:[t.jsx("h3",{className:"text-lg font-bold text-yellow-600 mb-2",children:"Diferencias Detectadas"}),t.jsx("p",{className:"mb-4 text-gray-700",children:"Hay ítems con diferencias. ¿Desea finalizar con errores?"}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{onClick:()=>H(!1),className:"btn-sap btn-secondary",children:"Cancelar"}),t.jsx("button",{onClick:()=>{H(!1),E(!0)},className:"btn-sap btn-primary bg-yellow-500 border-yellow-600",children:"Sí, Continuar"})]})]})}),I&&t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-sm w-full",children:[t.jsx("h3",{className:"text-lg font-bold mb-2",children:"Cantidad de Bultos"}),t.jsx("p",{className:"mb-2 text-gray-600",children:"Ingrese total de paquetes:"}),t.jsx("input",{type:"number",value:F,onChange:e=>M(e.target.value),className:"mb-4 text-center text-xl",autoFocus:!0,min:"0"}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{onClick:()=>E(!1),className:"btn-sap btn-secondary",children:"Cancelar"}),t.jsx("button",{onClick:()=>(()=>{const e=parseInt(F);if(!e||e<=0)return void $();const t={};v.forEach(s=>{const a={};for(let t=1;t<=e;t++)a[t]=0;1===e&&(a[1]=s.qty_scan),t[s.code]=a}),V(t),E(!1),T(!0)})(),className:"btn-sap btn-primary bg-blue-600 border-blue-700 text-white",children:"Continuar"})]})]})}),D&&t.jsx("div",{className:"fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsx("h3",{className:"text-lg font-bold mb-4",children:"Distribuir Ítems en Bultos"}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-sm border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-100",children:[t.jsx("th",{className:"p-2 text-left border",children:"Item"}),t.jsx("th",{className:"p-2 text-center border w-24",children:"Total Scan"}),Array.from({length:parseInt(F)||1}).map((e,s)=>t.jsxs("th",{className:"p-2 text-center border w-20",children:["Bulto ",s+1]},s)),t.jsx("th",{className:"p-2 text-center border w-24",children:"Asignado"})]})}),t.jsx("tbody",{children:v.map(e=>{const s=O[e.code]||{},a=Object.values(s).reduce((e,t)=>e+t,0),r=a===e.qty_scan;return 0===e.qty_scan?null:t.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[t.jsxs("td",{className:"p-2 border font-medium",children:[e.code,t.jsx("div",{className:"text-xs text-gray-500 truncate max-w-xs",children:e.description})]}),t.jsx("td",{className:"p-2 text-center border font-bold",children:e.qty_scan}),Array.from({length:parseInt(F)||1}).map((a,r)=>t.jsx("td",{className:"p-1 border text-center",children:t.jsx("input",{type:"number",min:"0",className:"w-16 text-center border rounded p-1",value:s[r+1]||0,onChange:t=>((e,t,s)=>{const a=parseInt(s)||0;V(s=>({...s,[e]:{...s[e],[t]:a}}))})(e.code,r+1,t.target.value),onFocus:e=>e.target.select()})},r)),t.jsx("td",{className:"p-2 text-center border font-bold "+(r?"text-green-600":"text-red-600"),children:a})]},e.code)})})]})}),t.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[t.jsx("button",{onClick:()=>T(!1),className:"btn-sap btn-secondary",children:"Atrás"}),t.jsx("button",{onClick:()=>$(),className:"btn-sap btn-success bg-green-600 border-green-700 text-white",children:"Guardar y Finalizar"})]})]})})]}):t.jsxs("div",{className:"container-wrapper max-w-3xl mx-auto px-4 py-8",children:[t.jsx(n,{position:"top-right",autoClose:3e3}),t.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-xl border border-gray-200",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Cargar Pedido Picking"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"form-label",children:"Order Number"}),t.jsx("input",{type:"text",value:d,onChange:e=>o(e.target.value),placeholder:"Ej: 0043785"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"form-label",children:"Despatch Number"}),t.jsx("input",{type:"text",value:x,onChange:e=>h(e.target.value),placeholder:"Ej: 00"})]})]}),t.jsx("button",{onClick:async()=>{if(d&&x){u(!0);try{const e=await fetch(`/api/picking/order/${d}/${x}`,{credentials:"include"});if(e.ok){const t=await e.json();if(t&&t.length>0){y(t[0]["Customer Name"]);const e=t.map(e=>({code:e["Item Code"],description:e["Item Description"],order_line:e["Order Line"],qty_req:parseInt(e.Qty||0),qty_scan:0,difference:0}));N(e),f(!0),r.success("Pedido cargado")}else r.error("Pedido vacio o no encontrado")}else r.error("Pedido no encontrado")}catch(e){r.error("Error de conexión")}finally{u(!1)}}else r.error("Ingrese Order y Despatch Number")},disabled:m,className:"btn-sap btn-primary w-full py-3 mb-8 text-base shadow-sm",children:m?"Cargando...":"Comenzar Auditoría"}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("h3",{className:"font-semibold text-gray-700",children:"Pedidos Recientes"}),t.jsx("button",{onClick:P,className:"text-blue-600 text-sm hover:underline",children:"Actualizar"})]}),t.jsx("div",{className:"border border-gray-200 rounded overflow-hidden max-h-60 overflow-y-auto",children:t.jsxs("table",{className:"w-full text-left text-sm sap-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Order"}),t.jsx("th",{children:"Despatch"}),t.jsx("th",{children:"Cliente"}),t.jsx("th",{children:"Líneas"}),t.jsx("th",{children:"Fecha"})]})}),t.jsx("tbody",{children:0===b.length?t.jsx("tr",{children:t.jsx("td",{colSpan:"5",className:"text-center p-4 text-gray-500",children:"No hay pedidos recientes"})}):b.map((e,s)=>t.jsxs("tr",{className:"cursor-pointer hover:bg-blue-50",onClick:()=>{o(e.order_number),h(e.despatch_number)},children:[t.jsx("td",{className:"font-medium",children:e.order_number}),t.jsx("td",{children:e.despatch_number}),t.jsx("td",{className:"truncate max-w-[150px]",children:e.customer_name}),t.jsx("td",{className:"text-center font-bold text-blue-600",children:e.total_lines}),t.jsx("td",{className:"text-gray-500 text-xs",children:e.print_date})]},s))})]})})]})]})]})};export{i as default};
