import{j as e}from"./index-D2N3aOe4.js";import{h as s,r as a}from"./react-vendor-BFe66WFD.js";import{A as r}from"./AdminLayout-bCRyPPGi.js";const t=()=>{var t;const n=s(),[i,d]=a.useState(null),[o,l]=a.useState(0),[c,x]=a.useState(!1),[m,g]=a.useState(null),[b,h]=a.useState(null),u=async()=>{try{const e=await fetch("/api/admin/inventory/summary");if(401===e.status||403===e.status)return void n("/admin/login");if(!e.ok)throw new Error("Error al cargar estadísticas");const s=await e.json();d(s.stats),l(s.stage)}catch(e){h(e.message)}};a.useEffect(()=>{u()},[]);const p=async(e,s)=>{if(window.confirm(s)){x(!0),g(null),h(null);try{const s=await fetch(e,{method:"POST"});if(!s.ok){const e=await s.json();throw new Error(e.detail||"Error en la operación")}const a=await s.json();g(a.message),u()}catch(a){h(a.message)}finally{x(!1)}}},y=e=>{window.location.href=`/api/export_recount_list/${e}`};return e.jsxs(r,{title:"Administración de Inventario",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8 border-b border-gray-200 pb-4",children:[e.jsx("h1",{className:"text-2xl font-normal text-gray-800",children:"Panel de Control de Inventario"}),e.jsx("div",{className:"flex gap-4",children:e.jsx("button",{onClick:()=>n("/admin/users"),className:"bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-50 transition-colors text-sm font-medium",children:"Gestionar Usuarios"})})]}),m&&e.jsx("div",{className:"bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6 rounded-r shadow-sm",children:m}),b&&e.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-r shadow-sm",children:b}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded shadow-sm border-t-4 border-[#0a6ed1] text-center",children:[e.jsx("h3",{className:"text-gray-500 uppercase text-xs font-bold tracking-wider mb-2",children:"Etapa Actual"}),e.jsx("div",{className:"text-4xl font-light text-[#0a6ed1]",children:0===o?"Sin Ciclo Activo":`Etapa ${o}`})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-5 rounded shadow-sm border transition-all "+(0===o||4===o?"bg-white border-blue-200 ring-1 ring-blue-100":"bg-gray-50 border-gray-200 opacity-60"),children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Etapa 1: Conteo Total"}),e.jsx("span",{className:"text-xs font-mono bg-gray-100 px-2 py-0.5 rounded text-gray-500",children:"INIT"})]}),e.jsx("p",{className:"text-gray-500 text-xs mb-4",children:"Inicia un nuevo ciclo. Limpia conteos anteriores. Requiere confirmación."}),e.jsx("button",{onClick:()=>p("/api/admin/inventory/start_stage_1","¿Iniciar Etapa 1? Se borrarán todos los datos anteriores."),disabled:c||0!==o&&4!==o,className:"w-full bg-[#0a6ed1] text-white py-2 rounded text-sm hover:bg-[#0854a0] disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:"Iniciar Inventario"})]}),e.jsxs("div",{className:"p-5 rounded shadow-sm border transition-all "+(1===o?"bg-white border-[#e9730c] ring-1 ring-orange-100":"bg-gray-50 border-gray-200 opacity-60"),children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Etapa 2: Primer Reconteo"}),e.jsx("span",{className:"text-xs font-mono bg-gray-100 px-2 py-0.5 rounded text-gray-500",children:"R1"})]}),e.jsx("p",{className:"text-gray-500 text-xs mb-4",children:"Calcula diferencias de Etapa 1 y genera listas."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>p("/api/admin/inventory/advance_stage/2","¿Avanzar a Etapa 2?"),disabled:c||1!==o,className:"w-full bg-[#e9730c] text-white py-2 rounded text-sm hover:bg-[#cf660b] disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:"Calcular y Avanzar"}),2===o&&e.jsx("button",{onClick:()=>y(2),className:"w-full border border-green-600 text-green-700 py-1.5 rounded text-sm hover:bg-green-50 transition-colors",children:"Descargar Lista Reconteo"})]})]}),e.jsxs("div",{className:"p-5 rounded shadow-sm border transition-all "+(2===o?"bg-white border-[#e9730c] ring-1 ring-orange-100":"bg-gray-50 border-gray-200 opacity-60"),children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Etapa 3: Segundo Reconteo"}),e.jsx("span",{className:"text-xs font-mono bg-gray-100 px-2 py-0.5 rounded text-gray-500",children:"R2"})]}),e.jsx("p",{className:"text-gray-500 text-xs mb-4",children:"Revisión de diferencias persistentes."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>p("/api/admin/inventory/advance_stage/3","¿Avanzar a Etapa 3?"),disabled:c||2!==o,className:"w-full bg-[#e9730c] text-white py-2 rounded text-sm hover:bg-[#cf660b] disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:"Calcular y Avanzar"}),3===o&&e.jsx("button",{onClick:()=>y(3),className:"w-full border border-green-600 text-green-700 py-1.5 rounded text-sm hover:bg-green-50 transition-colors",children:"Descargar Lista Reconteo"})]})]}),e.jsxs("div",{className:"p-5 rounded shadow-sm border transition-all "+(3===o?"bg-white border-[#e9730c] ring-1 ring-orange-100":"bg-gray-50 border-gray-200 opacity-60"),children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Etapa 4: Final"}),e.jsx("span",{className:"text-xs font-mono bg-gray-100 px-2 py-0.5 rounded text-gray-500",children:"FIN"})]}),e.jsx("p",{className:"text-gray-500 text-xs mb-4",children:"Último conteo de diferencias restantes."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>p("/api/admin/inventory/advance_stage/4","¿Avanzar a Etapa 4?"),disabled:c||3!==o,className:"w-full bg-[#e9730c] text-white py-2 rounded text-sm hover:bg-[#cf660b] disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:"Avanzar a Etapa 4"}),4===o&&e.jsx("button",{onClick:()=>y(4),className:"w-full border border-green-600 text-green-700 py-1.5 rounded text-sm hover:bg-green-50 transition-colors",children:"Descargar Lista Reconteo"})]})]})]}),e.jsxs("div",{className:"p-6 rounded shadow-sm border transition-all "+(4===o?"bg-white border-green-500 ring-1 ring-green-100 check-pattern":"bg-gray-50 border-gray-200 opacity-60"),children:[e.jsx("h3",{className:"text-lg font-medium text-green-800 mb-2",children:"Finalizar Ciclo"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Cierra el inventario y permite generar informe final."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[4===o&&e.jsx("button",{onClick:()=>{window.location.href="/admin/inventory/report"},className:"flex-1 bg-white border border-blue-600 text-blue-700 py-2 rounded text-sm hover:bg-blue-50 transition-colors font-medium",children:"Generar Informe Final (Excel)"}),e.jsx("button",{onClick:()=>p("/api/admin/inventory/finalize","¿Finalizar Inventario?"),disabled:c||4!==o,className:"flex-1 bg-[#107e3e] text-white py-2 rounded text-sm hover:bg-[#0c6b33] disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-medium",children:"Finalizar y Cerrar Inventario"})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded shadow-sm h-fit border border-gray-200 sticky top-20",children:[e.jsx("h2",{className:"text-lg font-normal text-gray-800 mb-4 border-b pb-2",children:"Resumen en Tiempo Real"}),i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-3",children:"General"}),e.jsxs("div",{className:"flex justify-between items-center text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600",children:"Items en Maestro"}),e.jsx("span",{className:"font-mono font-medium bg-gray-100 px-2 py-0.5 rounded",children:(null==(t=i.general)?void 0:t.total_items_master)||0})]})]}),e.jsx("div",{className:"space-y-4",children:i.stages&&Object.entries(i.stages).map(([s,a])=>e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),e.jsxs("h4",{className:"font-medium text-sm text-gray-800",children:["Etapa ",s]})]}),e.jsxs("div",{className:"pl-4 border-l-2 border-gray-100 group-hover:border-blue-100 transition-colors space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsx("span",{children:"Contados:"}),e.jsx("span",{className:"font-medium",children:a.items_counted})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsx("span",{children:"Unidades:"}),e.jsx("span",{className:"font-medium",children:a.total_units_counted})]}),e.jsxs("div",{className:"flex justify-between text-xs text-red-600 bg-red-50 px-1 rounded",children:[e.jsx("span",{children:"Diferencias:"}),e.jsx("span",{className:"font-bold",children:a.items_with_discrepancy})]}),e.jsxs("div",{className:"flex justify-between text-xs text-green-700 bg-green-50 px-1 rounded mt-1",children:[e.jsx("span",{children:"Precisión:"}),e.jsx("span",{className:"font-bold",children:a.accuracy})]}),void 0!==a.items_in_recount_list&&a.items_in_recount_list>0&&e.jsxs("div",{className:"flex justify-between text-xs font-bold text-orange-600 mt-2 border-t pt-1 border-gray-100",children:[e.jsx("span",{children:"Para Reconteo:"}),e.jsx("span",{children:a.items_in_recount_list})]})]})]},s))})]}):e.jsx("div",{className:"flex justify-center py-8 text-gray-400",children:e.jsx("span",{className:"text-sm",children:"Cargando datos..."})})]})]})]})};export{t as default};
