import{j as e}from"./index-BGai6ft1.js";import{e as r,r as s}from"./react-vendor-BFe66WFD.js";const a=()=>{const{setTitle:a}=r(),[t,o]=s.useState({success:"",error:""}),[n,l]=s.useState(!1),[c,d]=s.useState(!1),[i,m]=s.useState([]);s.useEffect(()=>{a("Actualizar Ficheros")},[a]);const[u,p]=s.useState("combine"),[x,h]=s.useState(""),[g,b]=s.useState(""),[f,j]=s.useState([]),[v,y]=s.useState([]),[N,w]=s.useState(!1),[k,S]=s.useState(null);s.useEffect(()=>{const e=i.find(e=>{const r=e.name.toLowerCase();return r.includes("280")||r.includes("pedido")||r.includes("reporte")});e?e===k||N||C(e):(j([]),y([]),S(null))},[i,k,N]);const C=async e=>{w(!0),S(e);try{const r=new FormData;r.append("file",e);const s=await fetch("/api/preview_grn_file",{method:"POST",body:r}),a=await s.json();s.ok&&a.grns&&(j(a.grns),y(a.grns))}catch(r){o({success:"",error:"Error al leer las GRNs del archivo."}),S(null)}finally{w(!1)}},L=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?d(!0):"dragleave"===e.type&&d(!1)},D=e=>{m(r=>[...r,...Array.from(e)])};return e.jsxs("div",{className:"container-wrapper max-w-4xl mx-auto px-4 py-8",children:[t.error&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:t.error}),t.success&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:t.success}),e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden mb-8 border border-gray-200",children:[e.jsx("div",{className:"bg-gray-100 px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Actualización de Archivos"})}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-gray-600 mb-6 text-sm",children:"Suba los ficheros para actualizar la base de datos maestra y de GRN."}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),o({success:"",error:""}),l(!0);const r=new FormData;i.forEach(e=>{const s=e.name.toLowerCase();s.includes("master")||s.includes("item")?r.append("item_master",e):s.includes("280")||s.includes("pedido")||s.includes("reporte")?r.append("grn_file",e):(s.includes("240")||s.includes("picking"))&&r.append("picking_file",e)}),r.append("update_option_280",u),f.length>0&&r.append("selected_grns_280",JSON.stringify(v));try{const e=await fetch("/api/update",{method:"POST",body:r}),s=await e.json();e.ok?(o({success:s.message,error:""}),m([]),j([]),y([])):o({success:"",error:s.error||"Error uploading files"})}catch(s){o({success:"",error:s.message})}finally{l(!1)}},children:[e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-10 text-center transition-colors cursor-pointer mb-6 "+(c?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),onDragEnter:L,onDragLeave:L,onDragOver:L,onDrop:e=>{e.preventDefault(),e.stopPropagation(),d(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&D(e.dataTransfer.files)},onClick:()=>document.getElementById("file-upload").click(),children:[e.jsx("input",{id:"file-upload",type:"file",multiple:!0,accept:".csv",className:"hidden",onChange:e=>{e.preventDefault(),e.target.files&&e.target.files[0]&&D(e.target.files)}}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsxs("p",{className:"text-gray-600 font-medium mb-1",children:[e.jsx("span",{className:"font-bold text-gray-700",children:"Click to upload"})," or drag and drop"]}),e.jsx("p",{className:"text-gray-400 text-sm",children:"CSV files (250, 280, 240)"})]})]}),i.length>0&&e.jsxs("div",{className:"mb-6 space-y-2",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-700",children:"Archivos seleccionados:"}),i.map((r,s)=>e.jsxs("div",{className:"flex items-center justify-between text-sm bg-gray-50 p-2 rounded border border-gray-200",children:[e.jsxs("span",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z",clipRule:"evenodd"})}),r.name]}),e.jsx("button",{type:"button",onClick:()=>{return e=s,void m(r=>r.filter((r,s)=>s!==e));var e},className:"text-red-500 hover:text-red-700",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]},s))]}),f.length>0&&e.jsxs("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsx("p",{className:"font-medium text-gray-700 mb-3",children:"Opción de actualización para el archivo 280:"}),e.jsxs("div",{className:"flex items-center gap-6 mb-4",children:[e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"combine",checked:"combine"===u,onChange:e=>p(e.target.value),className:"form-radio text-blue-600 h-4 w-4"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Combinar (Agregar nuevas)"})]}),e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"replace",checked:"replace"===u,onChange:e=>p(e.target.value),className:"form-radio text-blue-600 h-4 w-4"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Reemplazar Todo"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("p",{className:"font-medium text-gray-700 text-sm",children:"Seleccionar GRNs a importar:"}),e.jsxs("div",{className:"text-xs",children:[e.jsx("button",{type:"button",onClick:()=>y([...f]),className:"text-blue-600 hover:underline mr-2",children:"Seleccionar Todas"}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsx("button",{type:"button",onClick:()=>y([]),className:"text-blue-600 hover:underline ml-2",children:"Deseleccionar Todas"})]})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto bg-white p-3 rounded border border-gray-200 grid grid-cols-2 gap-2",children:f.map(r=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:`grn-${r}`,checked:v.includes(r),onChange:e=>{e.target.checked?y(e=>[...e,r]):y(e=>e.filter(e=>e!==r))},className:"h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"}),e.jsx("label",{htmlFor:`grn-${r}`,className:"ml-2 text-xs text-gray-700 truncate cursor-pointer",title:r,children:r})]},r))}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Solo se importarán las filas correspondientes a las GRNs marcadas."})]})]}),e.jsxs("button",{disabled:n||0===i.length,type:"submit",className:"w-full bg-[#1e73be] hover:bg-blue-700 text-white font-medium py-3 px-4 rounded transition-colors flex items-center justify-center gap-2 shadow-sm",children:[e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),n?"Procesando...":"Subir y Actualizar Archivos"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-red-50 shadow rounded-lg p-6 border border-red-200",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 text-red-800 flex items-center",children:[e.jsx("svg",{className:"w-6 h-6 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"Zona de Peligro"]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!window.confirm("¡PELIGRO! ¿Estás seguro de que quieres borrar TODOS los logs? Esta acción no se puede deshacer."))return;o({success:"",error:""}),l(!0);const r=new FormData;r.append("password",x);try{const e=await fetch("/api/clear_database",{method:"POST",body:r}),s=await e.json();e.ok?(o({success:s.message,error:""}),h("")):o({success:"",error:s.error||"Error clearing database"})}catch(s){o({success:"",error:s.message})}finally{l(!1)}},children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Ingrese la contraseña administrativa para borrar TODO el historial."}),e.jsx("input",{type:"password",placeholder:"Contraseña Admin",value:x,onChange:e=>h(e.target.value),className:"w-full border p-2 rounded mb-4",required:!0}),e.jsx("button",{disabled:n,type:"submit",className:"w-full bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700 font-bold",children:"Limpiar Base de Datos"})]})]}),e.jsxs("div",{className:"bg-green-50 shadow rounded-lg p-6 border border-green-200",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 text-green-800 flex items-center",children:[e.jsx("svg",{className:"w-6 h-6 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Backup Completo"]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),o({success:"",error:""}),l(!0);const r=new FormData;r.append("password",g);try{const e=await fetch("/api/export_all_log",{method:"POST",body:r});if(e.ok){const r=await e.blob(),s=window.URL.createObjectURL(r),a=document.createElement("a");a.href=s,a.download=`Backup_${(new Date).toISOString().slice(0,10)}.xlsx`,document.body.appendChild(a),a.click(),a.remove(),o({success:"Backup generado correctamente",error:""})}else{const r=await e.json();o({success:"",error:r.error||"Error generating backup"})}}catch(s){o({success:"",error:s.message})}finally{l(!1)}},children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Exportar todo el historial de logs (activo + archivado)."}),e.jsx("input",{type:"password",placeholder:"Contraseña Admin",value:g,onChange:e=>b(e.target.value),className:"w-full border p-2 rounded mb-4",required:!0}),e.jsx("button",{disabled:n,type:"submit",className:"w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 font-bold",children:"Descargar Backup"})]})]})]})]})};export{a as default};
