import{j as e}from"./index-D2N3aOe4.js";import{e as t,r as s}from"./react-vendor-BFe66WFD.js";import{L as a,y as r}from"./ui-vendor-i8Pm06Jj.js";/* empty css                      */import{S as n}from"./ScannerModal-CHq94hI4.js";const c=(e,t)=>{try{const s=new(window.AudioContext||window.webkitAudioContext),a=s.createOscillator(),r=s.createGain();a.connect(r),r.connect(s.destination),a.frequency.value=e,a.type=e>600?"sine":"square",r.gain.setValueAtTime(.3,s.currentTime),r.gain.exponentialRampToValueAtTime(.01,s.currentTime+t),a.start(s.currentTime),a.stop(s.currentTime+t)}catch(s){}},l=()=>c(200,.2),d=()=>{const{setTitle:d}=t(),[i,o]=s.useState(""),[x,h]=s.useState(""),[m,u]=s.useState(!1),[p,b]=s.useState([]),[j,y]=s.useState(!1),[g,f]=s.useState(""),[N,v]=s.useState([]),[w,C]=s.useState(""),[q,_]=s.useState(!1),[k,S]=s.useState(!1),[z,I]=s.useState(!1),[A,D]=s.useState(!1),[H,T]=s.useState(""),[E,M]=s.useState({});s.useEffect(()=>{d("Logix - Chequeo de Picking"),O()},[d]);const O=async()=>{try{const e=await fetch("/api/picking/tracking",{credentials:"include"});e.ok&&b(await e.json())}catch(e){}},P=()=>{y(!1),v([]),o(""),h(""),f(""),D(!1),M({}),T(""),O()},V=e=>{const t=e.trim().toUpperCase();if(!t)return;let s=N.findIndex(e=>e.code===t&&e.qty_scan<e.qty_req);if(-1===s&&(s=N.findIndex(e=>e.code===t)),s>-1){const e=[...N],t=e[s];t.qty_scan+=1,t.difference=t.qty_scan-t.qty_req,v(e),C(""),t.qty_scan<=t.qty_req?(c(800,.1),r.success(`Leído: ${t.code}`)):(l(),r.warning(`Exceso: ${t.code}`))}else l(),r.error(`Item NO pertenece al pedido: ${t}`)},F=()=>{N.some(e=>e.qty_scan!==e.qty_req)?S(!0):I(!0)},$=async e=>{const t={order_number:i,despatch_number:x,customer_name:g,status:N.some(e=>e.qty_scan!==e.qty_req)?"Con Diferencia":"Completo",items:N.map(e=>({code:e.code,description:e.description,order_line:e.order_line,qty_req:e.qty_req,qty_scan:e.qty_scan})),packages:parseInt(H||0),packages_assignment:E};try{const e=await fetch("/api/save_picking_audit",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(e.ok)r.success("Auditoría Finalizada Correctamente"),P(),S(!1),I(!1),D(!1),T("");else{const t=await e.json();r.error(t.detail||"Error al guardar")}}catch(s){r.error("Error de conexión")}};return j?e.jsxs("div",{className:"container-wrapper max-w-5xl mx-auto px-4 py-4",children:[e.jsx(a,{position:"top-right",autoClose:2e3}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6 border-b pb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Auditoría en Curso"}),e.jsxs("p",{className:"text-gray-600",children:["Orden: ",e.jsxs("span",{className:"font-mono font-bold text-black",children:[i," / ",x]})]}),e.jsxs("p",{className:"text-gray-600",children:["Cliente: ",e.jsx("span",{className:"font-bold text-black",children:g})]})]}),e.jsx("button",{onClick:P,className:"btn-sap btn-secondary text-xs",children:"Cancelar / Salir"})]}),e.jsxs("div",{className:"mb-6 flex gap-2",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("label",{className:"form-label",children:"Item Code (Scan)"}),e.jsx("input",{type:"text",value:w,onChange:e=>C(e.target.value.toUpperCase()),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),V(w))},className:"w-full uppercase",placeholder:"Escanear o escribir...",autoFocus:!0})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("button",{onClick:()=>_(!0),className:"btn-sap btn-secondary h-[38px] px-3",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z"}),e.jsx("path",{d:"M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z"}),e.jsx("path",{d:"M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z"}),e.jsx("path",{d:"M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z"}),e.jsx("path",{d:"M12 9h2V8h-2z"})]})}),e.jsx("button",{onClick:()=>V(w),className:"btn-sap btn-secondary h-[38px]",children:"Buscar"})]})]}),e.jsx("div",{className:"overflow-x-auto border border-gray-300 rounded mb-6",children:e.jsxs("table",{className:"w-full text-left sap-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Descripción"}),e.jsx("th",{className:"text-center w-16",children:"Req"}),e.jsx("th",{className:"text-center w-16",children:"Scan"}),e.jsx("th",{className:"text-center w-16",children:"Dif"})]})}),e.jsx("tbody",{children:N.map((t,s)=>{const a=t.qty_scan-t.qty_req,r=t.qty_scan===t.qty_req,n=t.qty_scan>t.qty_req;return e.jsxs("tr",{className:r?"bg-green-50":n?"bg-red-50":"",children:[e.jsx("td",{className:"font-medium",children:t.code}),e.jsx("td",{className:"text-sm truncate max-w-[200px]",children:t.description}),e.jsx("td",{className:"text-center",children:t.qty_req}),e.jsx("td",{className:"text-center font-bold",children:t.qty_scan}),e.jsx("td",{className:"text-center font-bold "+(0!==a?"text-red-600":"text-green-600"),children:a>0?`+${a}`:a})]},s)})})]})}),e.jsx("button",{onClick:F,className:"btn-sap btn-primary w-full py-3 text-lg",children:"Finalizar Auditoría"})]}),q&&e.jsx(n,{title:"Escanear Código",onScan:e=>{_(!1),V(e)},onClose:()=>_(!1)}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-sm w-full",children:[e.jsx("h3",{className:"text-lg font-bold text-yellow-600 mb-2",children:"Diferencias Detectadas"}),e.jsx("p",{className:"mb-4 text-gray-700",children:"Hay ítems con diferencias. ¿Desea finalizar con errores?"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>S(!1),className:"btn-sap btn-secondary",children:"Cancelar"}),e.jsx("button",{onClick:()=>{S(!1),I(!0)},className:"btn-sap btn-primary bg-yellow-500 border-yellow-600",children:"Sí, Continuar"})]})]})}),z&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-sm w-full",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Cantidad de Bultos"}),e.jsx("p",{className:"mb-2 text-gray-600",children:"Ingrese total de paquetes:"}),e.jsx("input",{type:"number",value:H,onChange:e=>T(e.target.value),className:"mb-4 text-center text-xl",autoFocus:!0,min:"0"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>I(!1),className:"btn-sap btn-secondary",children:"Cancelar"}),e.jsx("button",{onClick:()=>(()=>{const e=parseInt(H);if(!e||e<=0)return void $();const t={};N.forEach(s=>{const a={};for(let t=1;t<=e;t++)a[t]=0;1===e&&(a[1]=s.qty_scan),t[s.code]=a}),M(t),I(!1),D(!0)})(),className:"btn-sap btn-primary bg-blue-600 border-blue-700 text-white",children:"Continuar"})]})]})}),A&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Distribuir Ítems en Bultos"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"p-2 text-left border",children:"Item"}),e.jsx("th",{className:"p-2 text-center border w-24",children:"Total Scan"}),Array.from({length:parseInt(H)||1}).map((t,s)=>e.jsxs("th",{className:"p-2 text-center border w-20",children:["Bulto ",s+1]},s)),e.jsx("th",{className:"p-2 text-center border w-24",children:"Asignado"})]})}),e.jsx("tbody",{children:N.map(t=>{const s=E[t.code]||{},a=Object.values(s).reduce((e,t)=>e+t,0),r=a===t.qty_scan;return 0===t.qty_scan?null:e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsxs("td",{className:"p-2 border font-medium",children:[t.code,e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-xs",children:t.description})]}),e.jsx("td",{className:"p-2 text-center border font-bold",children:t.qty_scan}),Array.from({length:parseInt(H)||1}).map((a,r)=>e.jsx("td",{className:"p-1 border text-center",children:e.jsx("input",{type:"number",min:"0",className:"w-16 text-center border rounded p-1",value:s[r+1]||0,onChange:e=>((e,t,s)=>{const a=parseInt(s)||0;M(s=>({...s,[e]:{...s[e],[t]:a}}))})(t.code,r+1,e.target.value),onFocus:e=>e.target.select()})},r)),e.jsx("td",{className:"p-2 text-center border font-bold "+(r?"text-green-600":"text-red-600"),children:a})]},t.code)})})]})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx("button",{onClick:()=>D(!1),className:"btn-sap btn-secondary",children:"Atrás"}),e.jsx("button",{onClick:()=>$(),className:"btn-sap btn-success bg-green-600 border-green-700 text-white",children:"Guardar y Finalizar"})]})]})})]}):e.jsxs("div",{className:"container-wrapper max-w-3xl mx-auto px-4 py-8",children:[e.jsx(a,{position:"top-right",autoClose:3e3}),e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-xl border border-gray-200",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Cargar Pedido Picking"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Order Number"}),e.jsx("input",{type:"text",value:i,onChange:e=>o(e.target.value),placeholder:"Ej: 0043785"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Despatch Number"}),e.jsx("input",{type:"text",value:x,onChange:e=>h(e.target.value),placeholder:"Ej: 00"})]})]}),e.jsx("button",{onClick:async()=>{if(i&&x){u(!0);try{const e=await fetch(`/api/picking/order/${i}/${x}`,{credentials:"include"});if(e.ok){const t=await e.json();if(t&&t.length>0){f(t[0]["Customer Name"]);const e=t.map(e=>({code:e["Item Code"],description:e["Item Description"],order_line:e["Order Line"],qty_req:parseInt(e.Qty||0),qty_scan:0,difference:0}));v(e),y(!0),r.success("Pedido cargado")}else r.error("Pedido vacio o no encontrado")}else r.error("Pedido no encontrado")}catch(e){r.error("Error de conexión")}finally{u(!1)}}else r.error("Ingrese Order y Despatch Number")},disabled:m,className:"btn-sap btn-primary w-full py-3 mb-8 text-base shadow-sm",children:m?"Cargando...":"Comenzar Auditoría"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-700",children:"Pedidos Recientes"}),e.jsx("button",{onClick:O,className:"text-blue-600 text-sm hover:underline",children:"Actualizar"})]}),e.jsx("div",{className:"border border-gray-200 rounded overflow-hidden max-h-60 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-left text-sm sap-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Order"}),e.jsx("th",{children:"Despatch"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Líneas"}),e.jsx("th",{children:"Fecha"})]})}),e.jsx("tbody",{children:0===p.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center p-4 text-gray-500",children:"No hay pedidos recientes"})}):p.map((t,s)=>e.jsxs("tr",{className:"cursor-pointer hover:bg-blue-50",onClick:()=>{o(t.order_number),h(t.despatch_number)},children:[e.jsx("td",{className:"font-medium",children:t.order_number}),e.jsx("td",{children:t.despatch_number}),e.jsx("td",{className:"truncate max-w-[150px]",children:t.customer_name}),e.jsx("td",{className:"text-center font-bold text-blue-600",children:t.total_lines}),e.jsx("td",{className:"text-gray-500 text-xs",children:t.print_date})]},s))})]})})]})]})]})};export{d as default};
