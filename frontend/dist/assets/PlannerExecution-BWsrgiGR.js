const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/qrcode-vendor-ClTz9A3x.js","assets/react-vendor-BFe66WFD.js"])))=>i.map(i=>d[i]);
import{_ as e,j as t}from"./index-wQJwC0jU.js";import{e as s,f as a,r}from"./react-vendor-BFe66WFD.js";import{y as n}from"./ui-vendor-i8Pm06Jj.js";/* empty css                      */const c=()=>{const{setTitle:c}=s(),[i]=a(),d=(new Date).toISOString().split("T")[0],[l,o]=r.useState(i.get("date")||d);r.useEffect(()=>{c("Ejecución Diaria de Conteos")},[c]);const[x,h]=r.useState([]),[m,p]=r.useState(!1),[u,f]=r.useState(null),[g,y]=r.useState(null),[b,v]=r.useState(!1),[j,w]=r.useState(!1),[N,_]=r.useState(!1),z=r.useRef(null);r.useEffect(()=>{l&&C(l)},[l]),r.useEffect(()=>(j&&e(async()=>{const{Html5Qrcode:e}=await import("./qrcode-vendor-ClTz9A3x.js").then(e=>e.i);return{Html5Qrcode:e}},__vite__mapDeps([0,1])).then(({Html5Qrcode:e})=>{const t=new e("planner-reader");z.current=t,t.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},e=>{k(e)},e=>{}).catch(e=>{w(!1),n.error("Error al iniciar cámara")})}),()=>{if(z.current)try{z.current.stop().catch(()=>{});try{z.current.clear()}catch(e){}}catch(e){}}),[j]);const k=e=>{const t=e.trim().toUpperCase(),s=x.findIndex(e=>e.item_code===t);-1!==s?(n.success(`Item encontrado: ${t}`),setTimeout(()=>{const e=document.getElementById(`qty-${s}`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.focus(),e.select())},100),z.current?z.current.stop().then(()=>{try{z.current.clear()}catch(e){}z.current=null,w(!1)}).catch(e=>{w(!1)}):w(!1)):n.warning("Item no está en la lista de hoy")},C=async e=>{p(!0),f(null),h([]);try{const t=await fetch(`/api/planner/execution/daily_items?date=${e}`);if(!t.ok)throw new Error("Error al cargar ítems planificados");const s=(await t.json()).map(e=>({...e,physical_qty:"",difference:null,status:"pending"}));h(s)}catch(t){f(t.message)}finally{p(!1)}};return t.jsxs("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 py-4 sm:py-8",children:[t.jsxs("div",{className:"bg-white p-3 sm:p-4 rounded-lg shadow mb-4 sm:mb-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[t.jsx("label",{className:"font-semibold text-gray-700 text-sm whitespace-nowrap",children:"Fecha:"}),t.jsx("input",{type:"date",value:l,onChange:e=>o(e.target.value),className:"flex-1 rounded border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>C(l),className:"flex-1 sm:flex-none bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2.5 rounded text-sm font-medium transition-colors",children:"Actualizar"}),t.jsxs("button",{onClick:()=>w(!0),className:"flex-1 sm:flex-none bg-gray-700 hover:bg-gray-800 text-white px-4 py-2.5 rounded text-sm font-medium transition-colors flex items-center justify-center gap-2",children:[t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[t.jsx("path",{d:"M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z"}),t.jsx("path",{d:"M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z"}),t.jsx("path",{d:"M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z"}),t.jsx("path",{d:"M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z"}),t.jsx("path",{d:"M12 9h2V8h-2z"})]}),t.jsx("span",{className:"hidden sm:inline",children:"Escanear"}),t.jsx("span",{className:"sm:hidden",children:"Scan"})]})]})]}),g&&t.jsx("span",{className:"block mt-2 text-green-600 text-sm font-medium",children:g})]}),m?t.jsx("div",{className:"flex justify-center py-12",children:t.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"})}):u?t.jsx("div",{className:"bg-red-50 border border-red-200 text-red-600 p-4 rounded",children:u}):0===x.length?t.jsx("div",{className:"text-center py-12 text-gray-500 bg-white rounded shadow",children:"No hay ítems planificados para esta fecha."}):t.jsx("div",{className:"bg-white shadow overflow-hidden rounded-lg",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-[#34495e] text-white",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider w-auto",children:"Item"}),t.jsx("th",{className:"px-2 py-3 text-center text-xs font-semibold uppercase tracking-wider w-24",children:"Ubicación"}),t.jsx("th",{className:"px-2 py-3 text-center text-xs font-semibold uppercase tracking-wider w-16",children:"ABC"}),t.jsx("th",{className:"px-2 py-3 text-center text-xs font-semibold uppercase tracking-wider w-16",children:"Sistema"}),t.jsx("th",{className:"px-1 py-3 text-center text-xs font-semibold uppercase tracking-wider w-16",children:"Físico"}),t.jsx("th",{className:"px-1 py-3 text-center text-xs font-semibold uppercase tracking-wider w-16",children:"Dif"}),t.jsx("th",{className:"px-2 py-3 text-center text-xs font-semibold uppercase tracking-wider w-20",children:"Acción"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map((e,s)=>t.jsxs("tr",{className:e.saved?"bg-green-50":"",children:[t.jsxs("td",{className:"px-2 py-2",children:[t.jsx("div",{className:"text-sm font-medium text-indigo-600",children:e.item_code}),t.jsx("div",{className:"text-xs text-gray-500 truncate max-w-[150px] sm:max-w-xs",children:e.description})]}),t.jsx("td",{className:"px-1 py-2 text-sm text-gray-500 font-mono text-center",children:e.bin_location||"N/A"}),t.jsx("td",{className:"px-1 py-2 text-sm text-gray-500 text-center",children:e.abc_code}),t.jsx("td",{className:"px-1 py-2 text-sm text-center text-gray-900 font-medium",children:e.system_qty||0}),t.jsx("td",{className:"px-0 py-2 text-center",children:t.jsx("input",{id:`qty-${s}`,type:"number",className:"w-10 sm:w-12 text-center p-0 border rounded border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 text-sm no-spinner",value:e.physical_qty,onChange:e=>((e,t)=>{const s=[...x];s[e].physical_qty=t,h(s)})(s,e.target.value),onBlur:()=>(e=>{const t=[...x],s=t[e],a=parseInt(s.physical_qty);if(!isNaN(a)){const e=s.system_qty||0;s.difference=a-e,s.status="counted"}h(t)})(s),disabled:e.saved})}),t.jsx("td",{className:"px-1 py-2 text-center",children:null!==e.difference&&t.jsx("span",{className:"px-1.5 inline-flex text-xs leading-5 font-semibold rounded-full "+(0===e.difference?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.difference>0?`+${e.difference}`:e.difference})}),t.jsx("td",{className:"px-1 py-2 text-center",children:e.saved?t.jsx("span",{className:"text-green-600 font-bold text-xs",children:"OK"}):t.jsx("button",{onClick:()=>(async e=>{const t=x[e];if("counted"===t.status){v(!0),f(null),y(null);try{const s={item_code:t.item_code,item_description:t.description,bin_location:t.bin_location||"N/A",system_qty:t.system_qty||0,physical_qty:parseInt(t.physical_qty),difference:t.difference,executed_date:l,username:"admin",abc_code:t.abc_code};if(!(await fetch("/api/planner/save_execution",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("Error al guardar el conteo");y(`Conteo guardado para ${t.item_code}`),n.success(`Guardado: ${t.item_code}`);const a=[...x];a[e].saved=!0,h(a)}catch(s){f(s.message),n.error("Error al guardar")}finally{v(!1)}}})(s),disabled:b||"counted"!==e.status,className:"text-white px-2 py-1 rounded text-xs font-bold transition-colors "+("counted"===e.status?"bg-indigo-600 hover:bg-indigo-700":"bg-gray-300 cursor-not-allowed"),children:"Guardar"})})]},s))})]})})}),j&&t.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg relative",children:[t.jsx("h3",{className:"text-center font-bold text-lg mb-4 text-gray-800",children:"Apunta la cámara al código de barras"}),t.jsx("div",{id:"planner-reader",className:"rounded-lg overflow-hidden mb-4 border-2 border-gray-100"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("button",{onClick:()=>{z.current&&z.current.applyVideoConstraints({advanced:[{torch:!N}]}).then(()=>_(!N)).catch(e=>{n.error("Flash no disponible")})},className:"flex-1 h-12 flex items-center justify-center gap-2 rounded bg-[#34495e] hover:bg-[#2c3e50] text-white font-medium transition-colors "+(N?"ring-2 ring-yellow-400":""),title:N?"Apagar Flash":"Encender Flash",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",viewBox:"0 0 16 16",children:t.jsx("path",{d:"M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a1.964 1.964 0 0 0-.453-.618A5.984 5.984 0 0 1 2 6zm6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1z"})}),"Flash"]}),t.jsx("button",{onClick:()=>{z.current?z.current.stop().then(()=>{try{z.current.clear()}catch(e){}w(!1),z.current=null}).catch(()=>w(!1)):w(!1)},className:"flex-1 h-12 flex items-center justify-center bg-[#d32f2f] hover:bg-[#b71c1c] text-white font-medium rounded transition-colors",children:"Cancelar"})]})]})})]})};export{c as default};
