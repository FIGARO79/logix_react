import{j as e}from"./index-D2N3aOe4.js";import{e as t,r as a}from"./react-vendor-BFe66WFD.js";const s=()=>{const{setTitle:s}=t(),[r,n]=a.useState([]),[c,l]=a.useState(!0),[i,d]=a.useState(null),[o,x]=a.useState((new Date).getFullYear()),[h,m]=a.useState((new Date).getMonth()+1),[p,u]=a.useState(!0),[y,g]=a.useState(0),[b,j]=a.useState(null),[f,N]=a.useState("");a.useEffect(()=>{s("Gestión de Diferencias - Conteos Cíclicos")},[s]);const w=async()=>{l(!0);try{const e=new URLSearchParams({year:o,month:h,only_differences:p}),t=await fetch(`/api/planner/cycle_count_differences?${e}`);if(!t.ok)throw new Error("Error cargando datos");const a=await t.json();n(a)}catch(e){d(e.message)}finally{l(!1)}};a.useEffect(()=>{w()},[o,h,p,y]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6 font-sans text-xs",children:[e.jsxs("div",{className:"bg-white p-4 rounded shadow-sm border border-gray-200 mb-4 flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"Año"}),e.jsx("input",{type:"number",value:o,onChange:e=>x(e.target.value),className:"border border-gray-300 rounded px-2 py-1 w-20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"Mes"}),e.jsx("select",{value:h,onChange:e=>m(e.target.value),className:"border border-gray-300 rounded px-2 py-1 w-32",children:Array.from({length:12},(e,t)=>t+1).map(t=>e.jsx("option",{value:t,children:new Date(0,t-1).toLocaleString("es-ES",{month:"long"})},t))})]}),e.jsxs("div",{className:"flex items-center pb-2",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:e=>u(e.target.checked),id:"onlyDiff",className:"mr-2"}),e.jsx("label",{htmlFor:"onlyDiff",className:"cursor-pointer select-none",children:"Solo Diferencias"})]}),e.jsx("div",{className:"flex-grow"}),e.jsx("button",{onClick:w,className:"bg-blue-600 text-white px-4 py-1.5 rounded hover:bg-blue-700 transition",children:"Actualizar"})]}),e.jsx("div",{className:"bg-white shadow-sm rounded border border-gray-200 overflow-hidden",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-slate-700 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2",children:"Fecha Ejec."}),e.jsx("th",{className:"px-3 py-2",children:"Item Code"}),e.jsx("th",{className:"px-3 py-2",children:"Descripción"}),e.jsx("th",{className:"px-3 py-2",children:"Ubicación"}),e.jsx("th",{className:"px-3 py-2 text-center",children:"ABC"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Cant. Sistema"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Cant. Física"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Diferencia"}),e.jsx("th",{className:"px-3 py-2",children:"Usuario"}),e.jsx("th",{className:"px-3 py-2 text-center",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:c?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-4 text-gray-500",children:"Cargando..."})}):0===r.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-4 text-gray-500",children:"No se encontraron registros."})}):r.map(t=>{return e.jsxs("tr",{className:"hover:bg-blue-50 transition-colors",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:(a=t.executed_date,a||"")}),e.jsx("td",{className:"px-3 py-2 font-mono font-medium text-blue-700",children:t.item_code}),e.jsx("td",{className:"px-3 py-2 truncate max-w-[200px]",title:t.item_description,children:t.item_description}),e.jsx("td",{className:"px-3 py-2",children:t.bin_location}),e.jsx("td",{className:"px-3 py-2 text-center",children:t.abc_code}),e.jsx("td",{className:"px-3 py-2 text-right font-mono",children:t.system_qty}),e.jsx("td",{className:"px-3 py-2 text-right font-mono",children:t.physical_qty}),e.jsx("td",{className:"px-3 py-2 text-right font-bold "+(0!==t.difference?"text-red-600":"text-green-600"),children:t.difference>0?`+${t.difference}`:t.difference}),e.jsx("td",{className:"px-3 py-2 text-gray-600",children:t.username}),e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsx("button",{onClick:()=>{return j(e=t),void N(e.physical_qty);var e},className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-2 py-1 rounded border border-gray-300 text-[10px]",children:"RECOUNT"})})]},t.id);var a})})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow-lg max-w-sm w-full",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Actualizar Cantidad Física"}),e.jsxs("p",{className:"mb-2 text-gray-600",children:["Item: ",e.jsx("strong",{children:b.item_code})]}),e.jsxs("p",{className:"mb-4 text-gray-600",children:["Cant. Sistema: ",b.system_qty]}),e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Nueva Cantidad Física:"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500",value:f,onChange:e=>N(e.target.value),autoFocus:!0}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>j(null),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded",children:"Cancelar"}),e.jsx("button",{onClick:async()=>{if(b)try{const e=await fetch(`/api/planner/cycle_count_differences/${b.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({physical_qty:parseInt(f)})});if(e.ok)j(null),g(e=>e+1),alert("Cantidad actualizada correctamente");else{const t=await e.json();alert(t.detail||"Error al actualizar")}}catch(e){alert("Error de conexión")}},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Guardar"})]})]})})]})};export{s as default};
